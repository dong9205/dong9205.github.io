[{"categories":["documentation","kubernetes"],"content":"kubeadmé«˜å¯ç”¨é›†ç¾¤ ","date":"2023-11-30","objectID":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/:0:0","tags":["kubernetes","linux","haproxy","keepalived","é«˜å¯ç”¨"],"title":"Kubeadmé«˜å¯ç”¨é›†ç¾¤","uri":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"},{"categories":["documentation","kubernetes"],"content":"åŸºç¡€ç¯å¢ƒåˆå§‹åŒ– ","date":"2023-11-30","objectID":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/:1:0","tags":["kubernetes","linux","haproxy","keepalived","é«˜å¯ç”¨"],"title":"Kubeadmé«˜å¯ç”¨é›†ç¾¤","uri":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"},{"categories":["documentation","kubernetes"],"content":"å®‰è£…Docker,Containerd é…ç½®å…ˆå†³æ¡ä»¶ cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # è®¾ç½®æ‰€éœ€çš„ sysctl å‚æ•°ï¼Œå‚æ•°åœ¨é‡æ–°å¯åŠ¨åä¿æŒä¸å˜ cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # åº”ç”¨ sysctl å‚æ•°è€Œä¸é‡æ–°å¯åŠ¨ sudo sysctl --system é€šè¿‡è¿è¡Œä»¥ä¸‹æŒ‡ä»¤ç¡®è®¤ br_netfilter å’Œ overlay æ¨¡å—è¢«åŠ è½½ï¼š lsmod | grep br_netfilter lsmod | grep overlay é€šè¿‡è¿è¡Œä»¥ä¸‹æŒ‡ä»¤ç¡®è®¤ net.bridge.bridge-nf-call-iptablesã€net.bridge.bridge-nf-call-ip6tables å’Œ net.ipv4.ip_forward ç³»ç»Ÿå˜é‡åœ¨ä½ çš„ sysctl é…ç½®ä¸­è¢«è®¾ç½®ä¸º 1ï¼š sysctl net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward å®‰è£…dockerï¼Œcontainerd sudo yum install -y yum-utils sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo sudo yum -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin rm -f /etc/containerd/config.toml systemctl start docker ä¿®æ”¹containerdé…ç½® æŠ¥é”™: no master IPs were listed in storage, refusing to erase all endpoints for the kubernetes service éœ€è¦å°†SystemdCgroupä¿®æ”¹ä¸ºtrue: https://github.com/kubernetes/kubeadm/issues/1047 containerd config default \u003e /etc/containerd/config.toml sed -i 's#SystemdCgroup = false#SystemdCgroup = true#g' /etc/containerd/config.toml ","date":"2023-11-30","objectID":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/:1:1","tags":["kubernetes","linux","haproxy","keepalived","é«˜å¯ç”¨"],"title":"Kubeadmé«˜å¯ç”¨é›†ç¾¤","uri":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"},{"categories":["documentation","kubernetes"],"content":"å®‰è£…kubeadm å…³é—­swap å¦‚æœ kubelet æœªè¢«æ­£ç¡®é…ç½®ä½¿ç”¨äº¤æ¢åˆ†åŒºï¼Œåˆ™ä½ å¿…é¡»ç¦ç”¨äº¤æ¢åˆ†åŒºã€‚ ä¾‹å¦‚ï¼Œsudo swapoff -a å°†æš‚æ—¶ç¦ç”¨äº¤æ¢åˆ†åŒºã€‚è¦ä½¿æ­¤æ›´æ”¹åœ¨é‡å¯åä¿æŒä¸å˜ï¼Œè¯·ç¡®ä¿åœ¨å¦‚ /etc/fstabã€systemd.swap ç­‰é…ç½®æ–‡ä»¶ä¸­ç¦ç”¨äº¤æ¢åˆ†åŒºï¼Œå…·ä½“å–å†³äºä½ çš„ç³»ç»Ÿå¦‚ä½•é…ç½®ã€‚ å®‰è£… cat \u003c\u003cEOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF # å°† SELinux è®¾ç½®ä¸º permissive æ¨¡å¼ï¼ˆç›¸å½“äºå°†å…¶ç¦ç”¨ï¼‰ sudo setenforce 0 sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config sudo yum install -y kubelet-1.27.6 kubeadm-1.27.6 kubectl-1.27.6 --disableexcludes=kubernetes sudo systemctl enable --now kubelet ","date":"2023-11-30","objectID":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/:1:2","tags":["kubernetes","linux","haproxy","keepalived","é«˜å¯ç”¨"],"title":"Kubeadmé«˜å¯ç”¨é›†ç¾¤","uri":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"},{"categories":["documentation","kubernetes"],"content":"ä½¿ç”¨å†…éƒ¨etcdæ„å»ºé«˜å¯ç”¨é›†ç¾¤ ","date":"2023-11-30","objectID":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/:2:0","tags":["kubernetes","linux","haproxy","keepalived","é«˜å¯ç”¨"],"title":"Kubeadmé«˜å¯ç”¨é›†ç¾¤","uri":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"},{"categories":["documentation","kubernetes"],"content":"kube-apiserverè´Ÿè½½å‡è¡¡å™¨ ä½¿ç”¨haproxy+keepalivedçš„æ–¹å¼åšapiserveré«˜å¯ç”¨ æœºå™¨ IP å®‰è£…æ­¥éª¤ master1 192.168.25.3 kubeadmå®‰è£… master2 192.168.25.5 kubeadmå®‰è£… node1 192.168.25.4 kubeadmå®‰è£… VIP 192.168.25.6 kubeadmå®‰è£… é…ç½®haproxy é…ç½®kubeletçš„é™æ€pod yamlæ–‡ä»¶ cat /etc/kubernetes/manifests/haproxy.yaml apiVersion: v1 kind: Pod metadata: name: haproxy namespace: kube-system spec: containers: #- image: haproxy:2.1.4 - image: haproxy:2.8.4 name: haproxy livenessProbe: failureThreshold: 8 httpGet: host: localhost path: /healthz port: 30033 scheme: HTTPS volumeMounts: - mountPath: /usr/local/etc/haproxy/haproxy.cfg name: haproxyconf readOnly: true hostNetwork: true volumes: - hostPath: path: /etc/haproxy/haproxy.cfg type: FileOrCreate name: haproxyconf é…ç½®haproxyé…ç½® cat /etc/haproxy/haproxy.cfg # /etc/haproxy/haproxy.cfg #--------------------------------------------------------------------- # Global settings #--------------------------------------------------------------------- global log stdout local0 log stdout local1 notice daemon maxconn 75000 #--------------------------------------------------------------------- # common defaults that all the 'listen' and 'backend' sections will # use if not designated in their block #--------------------------------------------------------------------- defaults mode http log global option httplog option dontlognull option http-server-close option forwardfor except 127.0.0.0/8 option redispatch retries 1 timeout http-request 10s timeout queue 20s timeout connect 5s timeout client 20s timeout server 20s timeout http-keep-alive 10s timeout check 10s #--------------------------------------------------------------------- # apiserver frontend which proxys to the control plane nodes #--------------------------------------------------------------------- frontend apiserver bind *:30033 mode tcp option tcplog default_backend apiserver #--------------------------------------------------------------------- # round robin balancing for apiserver #--------------------------------------------------------------------- backend apiserver option httpchk GET /healthz http-check expect status 200 mode tcp option ssl-hello-chk balance roundrobin server master1 192.168.25.3:6443 check server master2 192.168.25.5:6443 check é…ç½®keepalived é…ç½®kubeletç®¡ç†é™æ€PODæ–‡ä»¶ cat /etc/kubernetes/manifests/keepalived.yaml apiVersion: v1 kind: Pod metadata: creationTimestamp: null name: keepalived namespace: kube-system spec: containers: - image: osixia/keepalived:stable name: keepalived resources: {} args: # Fix docker mounted file problems: https://github.com/osixia/docker-keepalived#fix-docker-mounted-file-problems - --copy-service securityContext: capabilities: add: - NET_ADMIN - NET_BROADCAST - NET_RAW volumeMounts: - mountPath: /container/service/keepalived/assets/keepalived.conf name: config - mountPath: /container/service/keepalived/assets/check_apiserver.sh name: check hostNetwork: true volumes: - hostPath: path: /etc/keepalived/keepalived.conf name: config - hostPath: path: /etc/keepalived/check_apiserver.sh name: check é…ç½®keepalived cat /etc/keepalived/keepalived.conf ! /etc/keepalived/keepalived.conf ! Configuration File for keepalived global_defs { router_id LVS_DEVEL } vrrp_script check_apiserver { script \"/container/service/keepalived/assets/check_apiserver.sh\" interval 3 weight -20 fall 10 rise 2 } vrrp_instance VI_1 { state MASTER interface eth0 virtual_router_id 51 priority 100 authentication { auth_type PASS auth_pass private } virtual_ipaddress { 192.168.25.6/26 dev eth0 label eth0:1 } unicast_src_ip 192.168.25.3 unicast_peer { 192.168.25.5 } track_script { check_apiserver } } é…ç½®æ£€æµ‹è„šæœ¬ cat /etc/keepalived/check_apiserver.sh #!/bin/sh errorExit() { echo \"*** $*\" 1\u003e\u00262 exit 1 } curl --silent --max-time 2 --insecure https://localhost:30033/ -o /dev/null || errorExit \"Error GET https://localhost:30033/\" if ip addr | grep -q 192.168.25.6; then curl --silent --max-time 2 --insecure https://192.168.25.6:30033/ -o /dev/null || errorExit \"Error GET https://192.168.25.6:30033/","date":"2023-11-30","objectID":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/:2:1","tags":["kubernetes","linux","haproxy","keepalived","é«˜å¯ç”¨"],"title":"Kubeadmé«˜å¯ç”¨é›†ç¾¤","uri":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"},{"categories":["documentation","kubernetes"],"content":"å…¶ä»–é—®é¢˜ kubectlä½¿ç”¨watchæ“ä½œ20ç§’å°±ä¼šæ–­å¼€ åŸå› æ˜¯å› ä¸ºhaproxyè®¾ç½®çš„20è¶…æ—¶ï¼Œä½†æ˜¯kubectlé»˜è®¤çš„ idle timeoutæ˜¯30ç§’ï¼Œå°†kubectlçš„idel timeouté…ç½®ä¸º15ç§’å³å¯. issue: https://github.com/kubernetes/kubeadm/issues/2227 export HTTP2_READ_IDLE_TIMEOUT_SECONDS=15 v1.27ç§»é™¤â€“pod-eviction-timeoutåæ€ä¹ˆä¿®æ”¹é©±é€PODæ—¶é•¿ https://kubernetes.io/zh-cn/blog/2023/03/17/upcoming-changes-in-kubernetes-v1-27/#%E7%A7%BB%E9%99%A4-pod-eviction-timeout-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0 ä½¿ç”¨æ±¡ç‚¹æ–¹å¼: https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/taint-and-toleration/#taint-based-evictions tolerations: - effect: NoExecute key: node.kubernetes.io/unreachable operator: Exists tolerationSeconds: 120 ä¸‹çº¿èŠ‚ç‚¹ kubectl cordon node1 kubectl drain --ignore-daemonsets node1 # --ignore-daemonsets é€‰é¡¹ä¸ºå¿½ç•¥DaemonSetç±»å‹çš„pod ","date":"2023-11-30","objectID":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/:2:2","tags":["kubernetes","linux","haproxy","keepalived","é«˜å¯ç”¨"],"title":"Kubeadmé«˜å¯ç”¨é›†ç¾¤","uri":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"},{"categories":["documentation","kubernetes"],"content":"å‚è€ƒæ–‡æ¡£ dockerå®‰è£…å®˜æ–¹æ–‡æ¡£: https://docs.docker.com/engine/install/centos/ å®¹å™¨è¿è¡Œæ—¶: https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/ å®‰è£… kubeadm: https://v1-27.docs.kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/ é«˜å¯ç”¨æ‹“æ‰‘é€‰é¡¹: https://v1-27.docs.kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/ha-topology/ åˆ©ç”¨ kubeadm åˆ›å»ºé«˜å¯ç”¨é›†ç¾¤: https://v1-27.docs.kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/high-availability/ é˜¿é‡Œäº‘ä½¿ç”¨keepalived: https://developer.aliyun.com/article/438705 ","date":"2023-11-30","objectID":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/:3:0","tags":["kubernetes","linux","haproxy","keepalived","é«˜å¯ç”¨"],"title":"Kubeadmé«˜å¯ç”¨é›†ç¾¤","uri":"/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"},{"categories":["documentation"],"content":"ä»‹ç» ä¹‹å‰å‡çº§éƒ½æ˜¯ç›´æ¥ä½¿ç”¨é˜¿é‡Œäº‘çš„æ§åˆ¶å°ï¼ŒåªçŸ¥é“å‡çº§äº†æ§åˆ¶é¢ï¼Œç„¶åå‡çº§äº†èŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸çŸ¥é“å…¶ä¸­çš„æ›´å¤šç»†èŠ‚ï¼Œæ‰€ä»¥è‡ªå·±åœ¨æµ‹è¯•ç¯å¢ƒå‡çº§å­¦ä¹ ä¸‹, å‡çº§çš„è¯ç›´æ¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£å‡çº§å³å¯: https://v1-28.docs.kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/#upgrading-control-plane-nodes, æˆ‘è¿™é‡Œä¸»è¦è®°å½•ä¸‹å‘½ä»¤å’Œé‡åˆ°çš„é—®é¢˜ ","date":"2024-08-23","objectID":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/:1:0","tags":[""],"title":"Kubernetes 1.27å‡çº§è‡³1.28","uri":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/"},{"categories":["documentation"],"content":"å‘½ä»¤ æˆ‘çš„æ˜¯æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œæ‰€ä»¥ç›´æ¥é‡å¯kubeletï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œè¯·å‚è€ƒæ–‡æ¡£é©±é€podã€é…ç½®èŠ‚ç‚¹ä¸å¯è°ƒåº¦ apt-get install -y kubeadm='1.28.13-1.1' kubeadm upgrade plan kubeadm upgrade apply v1.28.13 -y systemctl restart kubelet ","date":"2024-08-23","objectID":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/:2:0","tags":[""],"title":"Kubernetes 1.27å‡çº§è‡³1.28","uri":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/"},{"categories":["documentation"],"content":"æ‰§è¡Œupgrade applyæ—¶å¡åœ¨etcd ","date":"2024-08-23","objectID":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/:3:0","tags":[""],"title":"Kubernetes 1.27å‡çº§è‡³1.28","uri":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/"},{"categories":["documentation"],"content":"æŠ¥é”™ kubeadmå‡çº§çš„æŠ¥é”™ \u003e etcd endpoints read from pods â€¦â€¦ I0823 11:38:26.483010 12990 etcd.go:150] etcd endpoints read from pods: https://172.18.0.2:2379 context deadline exceeded error syncing endpoints with etcd k8s.io/kubernetes/cmd/kubeadm/app/util/etcd.NewFromCluster k8s.io/kubernetes/cmd/kubeadm/app/util/etcd/etcd.go:166 k8s.io/kubernetes/cmd/kubeadm/app/phases/upgrade.StaticPodControlPlane k8s.io/kubernetes/cmd/kubeadm/app/phases/upgrade/staticpods.go:443 k8s.io/kubernetes/cmd/kubeadm/app/phases/upgrade.PerformStaticPodUpgrade k8s.io/kubernetes/cmd/kubeadm/app/phases/upgrade/staticpods.go:617 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade.PerformControlPlaneUpgrade k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade/apply.go:216 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade.runApply k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade/apply.go:156 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade.newCmdApply.func1 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade/apply.go:74 github.com/spf13/cobra.(*Command).execute github.com/spf13/cobra@v1.6.0/command.go:916 github.com/spf13/cobra.(*Command).ExecuteC github.com/spf13/cobra@v1.6.0/command.go:1040 github.com/spf13/cobra.(*Command).Execute github.com/spf13/cobra@v1.6.0/command.go:968 k8s.io/kubernetes/cmd/kubeadm/app.Run k8s.io/kubernetes/cmd/kubeadm/app/kubeadm.go:50 main.main k8s.io/kubernetes/cmd/kubeadm/kubeadm.go:25 runtime.main runtime/proc.go:271 runtime.goexit runtime/asm_amd64.s:1695 failed to create etcd client k8s.io/kubernetes/cmd/kubeadm/app/phases/upgrade.StaticPodControlPlane k8s.io/kubernetes/cmd/kubeadm/app/phases/upgrade/staticpods.go:445 k8s.io/kubernetes/cmd/kubeadm/app/phases/upgrade.PerformStaticPodUpgrade k8s.io/kubernetes/cmd/kubeadm/app/phases/upgrade/staticpods.go:617 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade.PerformControlPlaneUpgrade k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade/apply.go:216 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade.runApply k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade/apply.go:156 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade.newCmdApply.func1 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade/apply.go:74 github.com/spf13/cobra.(*Command).execute github.com/spf13/cobra@v1.6.0/command.go:916 github.com/spf13/cobra.(*Command).ExecuteC github.com/spf13/cobra@v1.6.0/command.go:1040 github.com/spf13/cobra.(*Command).Execute github.com/spf13/cobra@v1.6.0/command.go:968 k8s.io/kubernetes/cmd/kubeadm/app.Run k8s.io/kubernetes/cmd/kubeadm/app/kubeadm.go:50 main.main k8s.io/kubernetes/cmd/kubeadm/kubeadm.go:25 runtime.main runtime/proc.go:271 runtime.goexit runtime/asm_amd64.s:1695 [upgrade/apply] FATAL k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade.runApply k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade/apply.go:157 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade.newCmdApply.func1 k8s.io/kubernetes/cmd/kubeadm/app/cmd/upgrade/apply.go:74 github.com/spf13/cobra.(*Command).execute github.com/spf13/cobra@v1.6.0/command.go:916 github.com/spf13/cobra.(*Command).ExecuteC github.com/spf13/cobra@v1.6.0/command.go:1040 github.com/spf13/cobra.(*Command).Execute github.com/spf13/cobra@v1.6.0/command.go:968 k8s.io/kubernetes/cmd/kubeadm/app.Run k8s.io/kubernetes/cmd/kubeadm/app/kubeadm.go:50 main.main k8s.io/kubernetes/cmd/kubeadm/kubeadm.go:25 runtime.main runtime/proc.go:271 runtime.goexit runtime/asm_amd64.s:1695 etcdçš„logs remote error: tls: bad certificate {\"level\":\"warn\",\"ts\":\"2024-08-23T13:51:24.330935Z\",\"caller\":\"embed/config_logging.go:169\",\"msg\":\"rejected connection\",\"remote-addr\":\"172.18.0.2:41408\",\"server-name\":\"172.18.0.2\",\"error\":\"remote error: tls: bad certificate\"} æŸ¥çœ‹äº†ç›¸å…³isuee, æ„Ÿè§‰åƒæ˜¯etcdè¯ä¹¦çš„é—®é¢˜: https://github.com/kubernetes/kubeadm/issues/910 https://github.com/kubernetes/kubernetes/pull/64988 https://github.com/kubernetes/kubeadm/issues/2560 ","date":"2024-08-23","objectID":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/:3:1","tags":[""],"title":"Kubernetes 1.27å‡çº§è‡³1.28","uri":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/"},{"categories":["documentation"],"content":"æ’æŸ¥æ­¥éª¤ å°ç‰ˆæœ¬å‡çº§ æœ€å¼€å§‹çœ‹åˆ°æœ‰çš„isueeä¸­è¯´å¯èƒ½æ˜¯è·¨çš„ç‰ˆæœ¬å¤ªå¤§ï¼Œæ‰€ä»¥å°è¯•äº†å°ç‰ˆæœ¬å‡çº§ï¼Œç»“æœè¿˜æ˜¯æŠ¥é”™. åœ¨æœºå™¨ä¸Šå®‰è£…etcdctlï¼Œç„¶åæŸ¥çœ‹etcdä¿¡æ¯ å®‰è£…etcdctl https://github.com/etcd-io/etcd/releases/tag/v3.5.7 cp /tmp/etcd-download-test/etcd /tmp/etcd-download-test/etcdctl /usr/local/bin/ etcdctl --endpoints https://127.0.0.1:2379 --cert=\"/etc/kubernetes/pki/etcd/server.crt\" --key=\"/etc/kubernetes/pki/etcd/server.key\" --cacert=\"/etc/kubernetes/pki/etcd/ca.crt\" member list -w table +------------------+---------+--------------------------+-------------------------+-------------------------+------------+ | ID | STATUS | NAME | PEER ADDRS | CLIENT ADDRS | IS LEARNER | +------------------+---------+--------------------------+-------------------------+-------------------------+------------+ | c9d4f4d293c08711 | started | k8s-test01-control-plane | https://172.18.0.3:2380 | https://172.18.0.2:2379 | false | +------------------+---------+--------------------------+-------------------------+-------------------------+------------+ etcdctl --endpoints https://127.0.0.1:2379 --cert=\"/etc/kubernetes/pki/etcd/server.crt\" --key=\"/etc/kubernetes/pki/etcd/server.key\" --cacert=\"/etc/kubernetes/pki/etcd/ca.crt\" endpoint health -w table +------------------------+--------+-------------+-------+ | ENDPOINT | HEALTH | TOOK | ERROR | +------------------------+--------+-------------+-------+ | https://127.0.0.1:2379 | true | 11.957984ms | | +------------------------+--------+-------------+-------+ ç¡®è®¤etcdå¼‚å¸¸ç‚¹ ä»ä¸Šä¸€æ­¥çš„ç»“æœï¼Œçœ‹åˆ°2ä¸ªå¼‚å¸¸ç‚¹ PEER ADDRSæ˜¯172.18.0.3 (åŸå› æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨çš„kindå®‰è£…çš„ï¼Œé‡å¯dockeråï¼Œå®¹å™¨çš„ipä¼šå˜åŒ–) IS LEARNERçš„çŠ¶æ€æ˜¯false (è¿™ä¸ªå¥½åƒæ˜¯å› ä¸ºæˆ‘æ˜¯1èŠ‚ç‚¹çš„é›†ç¾¤ï¼Œæ‰€ä»¥æ˜¯false) ç„¶åå½“æˆ‘å°è¯•ä½¿ç”¨172.18.0.2æŸ¥çœ‹etcdçŠ¶æ€æ—¶ï¼Œå‘ç°äº†å¦‚ä¸‹æŠ¥é”™ root@k8s-test01-control-plane:/etc/kubernetes/pki/etcd# etcdctl --endpoints https://172.18.0.2:2379 --cert=\"/etc/kubernetes/pki/etcd/server.crt\" --key=\"/etc/kubernetes/pki/etcd/server.key\" --cacert=\"/etc/kubernetes/pki/etcd/ca.crt\" m ember list -w table {\"level\":\"warn\",\"ts\":\"2024-08-23T13:32:36.628Z\",\"logger\":\"etcd-client\",\"caller\":\"v3@v3.5.7/retry_interceptor.go:62\",\"msg\":\"retrying of unary invoker failed\",\"target\":\"etcd-endpoints://0xc0003de000/172.18.0.2:2379\",\"attempt\":0,\"error\":\"rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = \\\"transport: authentication handshake failed: x509: certificate is valid for 172.18.0.3, 127.0.0.1, ::1, not 172.18.0.2\\\"\"} Error: context deadline exceeded ç¡®è®¤etcdè¯ä¹¦é…ç½®çš„DNS openssl x509 -in /etc/kubernetes/pki/etcd/server.crt -noout -text â€¦â€¦ X509v3 extensions: X509v3 Key Usage: critical Digital Signature, Key Encipherment X509v3 Extended Key Usage: TLS Web Server Authentication, TLS Web Client Authentication X509v3 Basic Constraints: critical CA:FALSE X509v3 Authority Key Identifier: keyid:9F:3B:70:71:EF:A2:A1:DA:F4:0F:87:80:D1:A0:BA:31:A5:EF:FB:3B X509v3 Subject Alternative Name: DNS:k8s-test01-control-plane, DNS:localhost, IP Address:172.18.0.3, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1 â€¦â€¦ æ‰€ä»¥å¯ä»¥ç¡®è®¤æ˜¯è¯ä¹¦çš„é—®é¢˜ï¼Œå› ä¸ºæœ€å¼€å§‹å®¹å™¨çš„IPæ˜¯172.18.0.3ï¼Œé›†ç¾¤åœ¨etcdçš„è¯ä¹¦ä¸­åªå…è®¸äº† 172.18.0.3, 127.0.0.1, ::1è¿™ä¸‰ä¸ªåœ°å€ï¼Œæ‰€ä»¥è®¿é—®172.18.0.2çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ã€‚ ","date":"2024-08-23","objectID":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/:3:2","tags":[""],"title":"Kubernetes 1.27å‡çº§è‡³1.28","uri":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/"},{"categories":["documentation"],"content":"è§£å†³æ–¹æ³• ä½¿ç”¨cfsslé‡æ–°ç”Ÿæˆæ”¯æŒ172.18.0.2çš„è¯ä¹¦å³å¯ # å®‰è£…cfssl curl -s -L -o /usr/local/bin/cfssl https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 curl -s -L -o /usr/local/bin/cfssljson https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 chmod +x /usr/local/bin/{cfssl,cfssljson} # ç”Ÿæˆè¯ä¹¦ cd /etc/kubernetes/pki mkdir cfssl cfssl print-defaults config \u003e cfssl/ca-config.json cd /etc/kubernetes/pki/etcd echo '{\"CN\":\"k8s-test01-control-plane\",\"hosts\":[\"\"],\"key\":{\"algo\":\"rsa\",\"size\":2048}}' | cfssl gencert -ca=ca.crt -ca-key=ca.key -profile=etcd-server -hostname=\"k8s-test01-control-plane,localhost,172.18.0.3,172.18.0.2,127.0.0.1,0:0:0:0:0:0:0:1\" - | cfssljson -bare etcd-server æ›¿æ¢é›†ç¾¤è¯ä¹¦ cd /etc/kubernetes/pki/etcd mkdir server/ mv server.crt server.crt.txt server.key server/ mv etcd-server-key.pem server.key mv etcd-server.pem server.crt é‡å¯ETCD mv /etc/kubernetes/manifests/etcd.yaml ~/etcd.yaml \u0026\u0026 sleep 3 \u0026\u0026 mv ~/etcd.yaml /etc/kubernetes/manifests/etcd.yaml ç„¶åå†æ¬¡å‡çº§é›†ç¾¤æ­£å¸¸ ","date":"2024-08-23","objectID":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/:3:3","tags":[""],"title":"Kubernetes 1.27å‡çº§è‡³1.28","uri":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/"},{"categories":["documentation"],"content":"å‚è€ƒæ–‡æ¡£ etcdctlå®‰è£…: https://github.com/etcd-io/etcd/releases/tag/v3.5.7 etcd TLS: https://etcd.io/docs/v3.5/op-guide/security/ cfsslç”Ÿæˆè¯ä¹¦: https://github.com/coreos/docs/blob/master/os/generate-self-signed-certificates.md cfsslä»“åº“åœ°å€: https://github.com/cloudflare/cfssl.git èŠ‚ç‚¹æ›´æ¢IP: https://www.qikqiak.com/post/how-to-change-k8s-node-ip/ ","date":"2024-08-23","objectID":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/:4:0","tags":[""],"title":"Kubernetes 1.27å‡çº§è‡³1.28","uri":"/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/"},{"categories":["documentation"],"content":"å‘ç‰ˆå†…å®¹diff ","date":"2024-07-30","objectID":"/diff/:0:0","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"å‰ç«¯ https://github.com/otakustay/react-diff-view.git ","date":"2024-07-30","objectID":"/diff/:1:0","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"ä»‹ç» è¯¥å·¥å…·æ˜¯å°†git diffçš„ç»“æœè¿›è¡Œè§£æï¼Œç„¶åå¯¹ä¸åŒçš„å†…å®¹è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå®ç°git diffçš„å±•ç¤ºã€‚ ","date":"2024-07-30","objectID":"/diff/:1:1","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"åç«¯ https://github.com/go-git/go-git.git è¯¥å·¥å…·å®ç°äº†git diffçš„åŠŸèƒ½ï¼Œé¦–å…ˆè°ƒç”¨go-diffå¯¹ä¸¤ä»½æ•°æ®è¿›è¡Œdiffï¼Œç„¶åæœ€ç»“æœè¿›è¡Œè§£æï¼Œè§£æä¸ºgit diffä¸€æ ·çš„æ•ˆæœ ","date":"2024-07-30","objectID":"/diff/:2:0","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"ç¤ºä¾‹ å¯¹prometheusçš„go.modå’Œalertmanagerçš„go.modè¿›è¡Œdiff, å¹¶åœ¨å‰ç«¯å±•ç¤º ","date":"2024-07-30","objectID":"/diff/:3:0","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"ä¸‹è½½æ–‡ä»¶ wget https://raw.githubusercontent.com/prometheus/prometheus/main/go.mod -O prometheus-go.mod wget https://raw.githubusercontent.com/prometheus/alertmanager/main/go.mod -O alertmanager-go.mod ","date":"2024-07-30","objectID":"/diff/:3:1","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"git diff git diff -U1 prometheus-go.mod alertmanager-go.mod ","date":"2024-07-30","objectID":"/diff/:3:2","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"ä½¿ç”¨go-gitåŒ…è¿›è¡Œdiff ä»£ç æ¯”è¾ƒè‡ƒè‚¿ï¼Œç›´æ¥æ‹¿çš„git-diffçš„æµ‹è¯•ä»£ç ï¼Œæ²¡ä¼˜åŒ– package main import ( \"bufio\" \"bytes\" \"fmt\" \"os\" \"testing\" \"github.com/go-git/go-git/v5/plumbing\" \"github.com/go-git/go-git/v5/plumbing/filemode\" gitdiff \"github.com/go-git/go-git/v5/plumbing/format/diff\" \"github.com/go-git/go-git/v5/utils/diff\" \"github.com/sergi/go-diff/diffmatchpatch\" ) type testFile struct { path string mode filemode.FileMode seed string } func (t testFile) Hash() plumbing.Hash { return plumbing.ComputeHash(plumbing.BlobObject, []byte(t.seed)) } func (t testFile) Mode() filemode.FileMode { return t.mode } func (t testFile) Path() string { return t.path } type testPatch struct { message string filePatches []testFilePatch } func (t testPatch) FilePatches() []gitdiff.FilePatch { var result []gitdiff.FilePatch for _, f := range t.filePatches { result = append(result, f) } return result } func (t testPatch) Message() string { return t.message } type testFilePatch struct { from, to *testFile chunks []testChunk } func (t testFilePatch) IsBinary() bool { return len(t.chunks) == 0 } func (t testFilePatch) Files() (gitdiff.File, gitdiff.File) { // Go is amazing switch { case t.from == nil \u0026\u0026 t.to == nil: return nil, nil case t.from == nil: return nil, t.to case t.to == nil: return t.from, nil } return t.from, t.to } func (t testFilePatch) Chunks() []gitdiff.Chunk { var result []gitdiff.Chunk for _, c := range t.chunks { result = append(result, c) } return result } type testChunk struct { content string op gitdiff.Operation } func (t testChunk) Content() string { return t.content } func (t testChunk) Type() gitdiff.Operation { return t.op } // readFile reads the contents of a file and returns it as a string. func readFile(filePath string) (string, error) { file, err := os.Open(filePath) if err != nil { return \"\", err } defer file.Close() scanner := bufio.NewScanner(file) var content string for scanner.Scan() { content += scanner.Text() + \"\\n\" } if err := scanner.Err(); err != nil { return \"\", err } return content, nil } func TestCustomDiff(t *testing.T) { // if len(os.Args) != 3 { // t.Logf(\"Usage: %s \u003cfile1\u003e \u003cfile2\u003e\\n\", os.Args[0]) // os.Exit(1) // } file1Path := \"prometheus-go.mod\" file2Path := \"alertmanager-go.mod\" text1, err := readFile(file1Path) if err != nil { fmt.Println(\"Error reading file1:\", err) os.Exit(1) } chunks := make([]testChunk, 0) text2, err := readFile(file2Path) if err != nil { fmt.Println(\"Error reading file2:\", err) os.Exit(1) } diffs := diff.Do(text1, text2) for _, chunk := range diffs { switch chunk.Type { case diffmatchpatch.DiffDelete: chunks = append(chunks, testChunk{ content: chunk.Text, op: gitdiff.Delete, }) default: chunks = append(chunks, testChunk{ content: chunk.Text, op: gitdiff.Operation(chunk.Type), }) } t.Log(\"------------------chunk------------------\") t.Log(chunk.Type) t.Log(chunk.Text) } buffer := bytes.NewBuffer(nil) e := gitdiff.NewUnifiedEncoder(buffer, 1).SetColor(gitdiff.NewColorConfig()) p := testPatch{ message: \"\", filePatches: []testFilePatch{{ from: \u0026testFile{ mode: filemode.Regular, path: file1Path, seed: text1, }, to: \u0026testFile{ mode: filemode.Regular, path: file2Path, seed: text2, }, chunks: chunks, }}, } err = e.Encode(p) if err != nil { t.Fatal(err) } fmt.Println(buffer.String()) } ","date":"2024-07-30","objectID":"/diff/:3:3","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"å‰ç«¯ import { parseDiff, Diff, Hunk } from \"react-diff-view\"; import \"react-diff-view/style/index.css\"; const diffText1 = ` DIFFçš„ç»“æœ `; function renderFile({ oldRevision, newRevision, type, hunks }) { return ( \u003cDiff key={oldRevision + \"-\" + newRevision} viewType=\"split\" diffType={type} hunks={hunks} \u003e {(hunks) =\u003e hunks.map((hunk) =\u003e \u003cHunk key={hunk.content} hunk={hunk} /\u003e)} \u003c/Diff\u003e ); } export default function App({}) { const files1 = parseDiff(diffText1); // console.log(files); return ( \u003cdiv\u003e \u003cdiv\u003e{files1.map(renderFile)}\u003c/div\u003e \u003c/div\u003e ); } ","date":"2024-07-30","objectID":"/diff/:3:4","tags":[""],"title":"å‘ç‰ˆå†…å®¹diff","uri":"/diff/"},{"categories":["documentation"],"content":"æŠ¥é”™ ","date":"2024-05-30","objectID":"/directory-index-full/:0:0","tags":[""],"title":"å•ä¸ªç›®å½•ä¸‹æ–‡ä»¶çˆ†æ»¡","uri":"/directory-index-full/"},{"categories":["documentation"],"content":"åˆ›å»ºæ–‡ä»¶æŠ¥é”™ No space left on device ","date":"2024-05-30","objectID":"/directory-index-full/:1:0","tags":[""],"title":"å•ä¸ªç›®å½•ä¸‹æ–‡ä»¶çˆ†æ»¡","uri":"/directory-index-full/"},{"categories":["documentation"],"content":"syslogæ—¥å¿—é”™è¯¯ Directory (ino: 4230742) index full, reach max htree level :2 Large directory feature is not enabled on this filesystem èƒŒæ™¯ åœ¨dataç›®å½•ä¸‹æ— æ³•åˆ›å»ºfile-1, ä½†æ˜¯å¯ä»¥åˆ›å»ºfile-2, é€šè¿‡df -hT å’Œ df -hiç¡®è®¤ä¸æ˜¯ç£ç›˜ä¸è¶³ã€ä¸æ˜¯inodeä¸è¶³å¯¼è‡´ ç»è¿‡æ’æŸ¥æ˜¯å› ä¸ºç›®å½•ä¸‹çš„æ–‡ä»¶è¶…è¿‡äº†ç›®å½•æ–‡ä»¶é™åˆ¶. ä½†æ˜¯åˆ é™¤ä¸€äº›æ–‡ä»¶åï¼Œåˆ›å»ºfile-1è¿˜æ˜¯æŠ¥é”™ è¯è¯´é‡å¯è§£å†³99%çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘é‡å¯å‘ç°è¿™æ˜¯å‰©ä½™çš„1%çš„é—®é¢˜. ","date":"2024-05-30","objectID":"/directory-index-full/:2:0","tags":[""],"title":"å•ä¸ªç›®å½•ä¸‹æ–‡ä»¶çˆ†æ»¡","uri":"/directory-index-full/"},{"categories":["documentation"],"content":"å‡ºç°é—®é¢˜çš„åŸå›  ext4è‡ªèº«æ²¡æœ‰åšç›¸å…³æ–¹é¢çš„é™åˆ¶ Linux 2.6.23ä»¥åå¼•å…¥çš„HTreeç´¢å¼•åšçš„ï¼Œ2-level HTreeç´¢å¼•é™å®šäº†çº¦10-12 millionï¼ˆç™¾ä¸‡ï¼‰ Linux 4.12ålargedirç‰¹æ€§å¼€å¯çš„è¯3-levelé™å®šäº†çº¦6 billionï¼ˆåäº¿ï¼‰ https://en.wikipedia.org/wiki/Ext4 **Unlimited number of subdirectories** ext4 does not limit the number of subdirectories in a single directory, except by the inherent size limit of the directory itself. (In ext3 a directory can have at most 32,000 subdirectories.)[17][obsolete source] To allow for larger directories and continued performance, ext4 in Linux 2.6.23 and later turns on HTree indices (a specialized version of a B-tree) by default, which allows directories up to approximately 10â€“12 million entries to be stored in the 2-level HTree index and 2 GB directory size limit for 4 KiB block size, depending on the filename length. In Linux 4.12 and later the large_dir feature enabled a 3-level HTree and directory sizes over 2 GB, allowing approximately 6 billion entries in a single directory. è§£å†³æ–¹æ¡ˆ ","date":"2024-05-30","objectID":"/directory-index-full/:3:0","tags":[""],"title":"å•ä¸ªç›®å½•ä¸‹æ–‡ä»¶çˆ†æ»¡","uri":"/directory-index-full/"},{"categories":["documentation"],"content":"tune2fså¯ç”¨ç£ç›˜large_dir æˆ‘æµ‹è¯•è¿‡ä¸€æ¬¡è¿™ç§æ–¹æ¡ˆï¼Œå½“æ—¶å‡ºç°äº†ç³»ç»Ÿå¼‚å¸¸ tune2fs -O large_dir /dev/mapper/vg_test-lv_home ","date":"2024-05-30","objectID":"/directory-index-full/:4:0","tags":[""],"title":"å•ä¸ªç›®å½•ä¸‹æ–‡ä»¶çˆ†æ»¡","uri":"/directory-index-full/"},{"categories":["documentation"],"content":"é‡å»ºç›®å½• mv data data-bak mkdir data find data-bak/ -type f | xargs -I {} -n 1 mv {} data/ å‚è€ƒè¿æ¥ http://blog.wafcloud.cn/linux/linux-ext4-reach-max-htree-level2.html ","date":"2024-05-30","objectID":"/directory-index-full/:5:0","tags":[""],"title":"å•ä¸ªç›®å½•ä¸‹æ–‡ä»¶çˆ†æ»¡","uri":"/directory-index-full/"},{"categories":["documentation"],"content":"å®‰è£…å‘½ä»¤ pip install csvkit mycli æ‰“å°JSONæ ¼å¼ ","date":"2024-05-30","objectID":"/json-format/:0:0","tags":[""],"title":"å°†MysqlæŸ¥è¯¢å†…å®¹è½¬æ¢ä¸ºJSON","uri":"/json-format/"},{"categories":["documentation"],"content":"åœ¨Mycliç»ˆç«¯ä¸­æ‰“å° $ mycli -P 3306 -proot mysql MySQL root@localhost:mysql\u003e \\T csv MySQL root@localhost:mysql\u003e pager csvjson | jq '.' ","date":"2024-05-30","objectID":"/json-format/:1:0","tags":[""],"title":"å°†MysqlæŸ¥è¯¢å†…å®¹è½¬æ¢ä¸ºJSON","uri":"/json-format/"},{"categories":["documentation"],"content":"åœ¨Linuxå‘½ä»¤è¡Œæ‰“å° mycli -P 3306 -proot mysql --csv -e \"select * from user;\" | csvjson | jq . å‚è€ƒè¿æ¥ https://github.com/dbcli/mycli/issues/753#issuecomment-504279817 ","date":"2024-05-30","objectID":"/json-format/:2:0","tags":[""],"title":"å°†MysqlæŸ¥è¯¢å†…å®¹è½¬æ¢ä¸ºJSON","uri":"/json-format/"},{"categories":["documentation"],"content":"React Antd ProTable expandable.expandedRowRenderæ”¯æŒæ»šåŠ¨æ›´æ–° ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:0:0","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":"éœ€æ±‚ä»‹ç» æŠ¥è­¦å¹³å°éœ€è¦å±•ç¤ºå„ä¸ªæŠ¥è­¦çš„äº‹ä»¶ï¼Œç›¸åŒçš„æŠ¥è­¦æ ‡é¢˜ä¼šè¢«èšåˆåœ¨ä¸€èµ·ï¼Œä½†æ˜¯ä¼šè®°å½•æ¯æ¬¡æŠ¥è­¦å†…å®¹ä½œä¸ºäº‹ä»¶å±•ç¤ºï¼Œæœ‰æ—¶å€™å‡ºç°å‡ ç™¾ä¸‡æ¬¡æŠ¥è­¦ï¼Œå¯¼è‡´å‰ç«¯åŠ è½½ç¼“æ…¢ï¼Œæ‰€ä»¥è€ƒè™‘æŠ¥è­¦äº‹ä»¶ä½¿ç”¨æ»šåŠ¨åŠ è½½çš„æ–¹å¼è·å– ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:1:0","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":"å‰ç«¯å®ç° ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:2:0","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":"protable \u003cProTable\u003cAPI.RuleListItem, API.PageParams\u003e actionRef={actionRef} rowKey=\"ID\" search={{ labelWidth: \"auto\", defaultCollapsed: true, }} scroll={{ x: true, }} dateFormatter={(value, valueType) =\u003e { return value.format('YYYY-MM-DDTHH:mm:ss.SSS+08:00'); }} form={{ syncToUrl: (values, type) =\u003e { if (type === 'get') { return { ...values, created_at: [values.startTime, values.endTime], }; } return values; }, }} headerTitle={getTitle()} request={async (params, sorter, filter) =\u003e { let data = await GetObjects() // è·å–æŠ¥è­¦åˆ—è¡¨ return data }} pagination={{ showSizeChanger: true, }} columns={columns} rowSelection={{ selections: [ Table.SELECTION_INVERT, Table.SELECTION_NONE, ], preserveSelectedRowKeys: true, onChange: (_, selectedRows) =\u003e { setSelectedRows(selectedRows); }, }} expandable={{ expandedRowRender: record =\u003e ( \u003cExpandedRowRender record={record} /\u003e // å°†recordä¼ ç»™expandedRowRender ), }} /\u003e ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:2:1","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":" const expandedRowRender = React.memo(({ record }) =\u003e { const [expandedData, setExpandedData] = useState\u003c[]\u003e(record.events); // é¦–å…ˆåœ¨è·å–æŠ¥è­¦åˆ—è¡¨æ—¶ï¼Œä¼šæ‹¿åˆ°æŠ¥è­¦çš„å‰10æ¡äº‹ä»¶ï¼Œåˆå§‹åŒ–äº‹ä»¶ const loadMoreData = () =\u003e { console.log(\"loadMoreData\"); GetEvents(\"events\", { alarmID: record.ID, startCount: expandedData.length, pageSize: 10 }).then((res) =\u003e { // åç«¯offset startCount limit pageSize setExpandedData(expandedData =\u003e { return [...expandedData, ...res.data].sort((firstItem, secondItem) =\u003e secondItem.ID - firstItem.ID) // å°†å·²æœ‰æ•°æ®å’Œæ–°æ•°æ®è¿›è¡Œåˆå¹¶å¹¶æŒ‰ç…§IDå€’åºå±•ç¤º }) } ) }; return ( \u003cdiv id=\"scrollableDiv\" style={{ height: 300, overflow: 'auto', padding: '0 16px', border: '1px solid rgba(140, 140, 140, 0.35)', }} \u003e \u003cInfiniteScroll dataLength={expandedData.length} next={loadMoreData} // æ¯æ¬¡æ»šåŠ¨åˆ°æœ«å°¾æ—¶ï¼Œä¼šæ‰§è¡ŒloadMoreDataè·å–æ›´å¤šçš„æ•°æ®. hasMore={expandedData.length \u003c record.eventCount} // æ˜¯å¦æœ‰æ›´å¤šæ•°æ®,eventCountä¼šè®°å½•eventçš„æ€»æ•°é‡ï¼Œå¦‚æœå½“å‰æ•°æ®é•¿åº¦å°äºeventCountï¼Œè¯´æ˜è¿˜æœ‰æ›´å¤šäº‹ä»¶ loader={\u003cSpin /\u003e} endMessage={\u003cDivider plain\u003eIt is all, nothing more ğŸ¤\u003c/Divider\u003e} scrollableTarget=\"scrollableDiv\" \u003e \u003cProTable columns={EventColumns} headerTitle={false} search={false} options={false} dataSource={expandedData} pagination={false} rowKey=\"ID\" /\u003e \u003c/InfiniteScroll\u003e \u003c/div \u003e ); }); ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:2:2","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":"ç›¸å…³é—®é¢˜ ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:3:0","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":"Rendered more fewer hooks than during the previous render è¿™ä¸ªæŠ¥é”™æ˜¯å› ä¸ºæˆ‘åœ¨expandedRowRenderä¸­ä½¿ç”¨useStateçš„æŠ¥é”™ï¼Œå› ä¸ºexpandedRowRenderæ˜¯å±äºretuençš„å†…å®¹ï¼Œä¼šæœ‰å¤šæ¬¡æ¸²æŸ“ï¼Œå¦‚æœåœ¨expandedRowRenderä½¿ç”¨useStateï¼Œä¼šå¯¼è‡´useStateè¢«æ¸²æŸ“å¤šæ¬¡ï¼Œè¿™æ˜¯Reactä¸å…è®¸çš„ï¼Œå‚è€ƒ: https://www.cnblogs.com/chuckQu/p/16644590.html. åç»­ç»è¿‡å’ŒGPTçš„æ²Ÿé€šï¼Œå‘ç°å¯ä»¥ä½¿ç”¨React.memoè§£å†³è¯¥é—®é¢˜ ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:3:1","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":"åœ¨ä½¿ç”¨React.memoä¹‹å‰ï¼Œå› ä¸ºæˆ‘çš„expandedRowRenderæ˜¯åœ¨å¦ä¸€ä¸ªTSæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨å‡½æ•°ä¼ é€’recordï¼Œç„¶ååœ¨expandedRowRenderä¸­è·å–æ–°çš„æ•°æ®ï¼Œå¹¶æ›´æ–°ä¸»ç»„ä»¶ä¸­çš„å†…å®¹ï¼Œä½†æ˜¯æˆ‘å‘ç°ä¸»ç»„ä»¶å†…å®¹æ›´æ–°ååœ¨expandedRowRenderä¸­çš„æ•°æ®ä¸ä¼šè¢«é‡æ–°æ¸²æŸ“,å‚è€ƒçš„GPTä»£ç å¦‚ä¸‹ import React, { useState, useEffect } from 'react'; import { Table } from 'antd'; import ExpandedRowComponent from './ExpandedRowComponent'; const ParentComponent = () =\u003e { const [expandedDataMap, setExpandedDataMap] = useState({}); // æ›´æ–°å±•å¼€è¡Œçš„æ•°æ® const updateExpandedRowData = (recordKey, newData) =\u003e { // åˆ›å»ºæ–°çš„å¯¹è±¡ä»¥ç¡®ä¿å¼•ç”¨å‘ç”Ÿå˜åŒ– const newExpandedDataMap = { ...expandedDataMap }; newExpandedDataMap[recordKey] = newData; setExpandedDataMap(newExpandedDataMap); }; useEffect(() =\u003e { const intervalId = setInterval(() =\u003e { console.log('Expanded Data Map:', expandedDataMap); }, 3000); return () =\u003e { clearInterval(intervalId); }; }, [expandedDataMap]); const columns = [ // ä¸»è¡¨æ ¼çš„åˆ—å®šä¹‰ // ä¾‹å¦‚ï¼š{ title: 'Name', dataIndex: 'name', key: 'name' } ]; const data = [ // ä¸»è¡¨æ ¼æ•°æ® // ä¾‹å¦‚ï¼š{ key: '1', name: 'John Brown' } ]; return ( \u003cTable columns={columns} dataSource={data} expandable={{ expandedRowRender: (record) =\u003e ( \u003cExpandedRowComponent record={record} expandedData={expandedDataMap[record.key] || []} // ä¼ é€’å±•å¼€è¡Œæ•°æ® updateExpandedRowData={updateExpandedRowData} /\u003e ), onExpand: (expanded, record) =\u003e { // åœ¨å±•å¼€æˆ–æ”¶èµ·æ—¶æ›´æ–°çŠ¶æ€ if (expanded) { // åŠ è½½å±•å¼€çš„æ•°æ®å¹¶æ›´æ–°çŠ¶æ€ // ä¾‹å¦‚ï¼šfetchExpandedData(record.key).then(newData =\u003e updateExpandedRowData(record.key, newData)); } else { // æ”¶èµ·æ—¶æ¸…ç©ºå±•å¼€çš„æ•°æ®çŠ¶æ€ updateExpandedRowData(record.key, []); } }, }} /\u003e ); }; export default ParentComponent; // ExpandedRowComponent.js import React from 'react'; import { Table } from 'antd'; const ExpandedRowComponent = ({ record, expandedData, updateExpandedRowData }) =\u003e { const handleUpdateExpandedData = () =\u003e { // è°ƒç”¨çˆ¶ç»„ä»¶ä¼ é€’çš„æ›´æ–°å‡½æ•°æ¥æ›´æ–°å±•å¼€è¡Œçš„æ•°æ® updateExpandedRowData(record.key, /* æ–°æ•°æ® */); }; const columns = [ // å®šä¹‰è¡¨æ ¼åˆ— // ä¾‹å¦‚ï¼š{ title: 'Column 1', dataIndex: 'column1', key: 'column1' } ]; return ( \u003cTable columns={columns} dataSource={expandedData} pagination={false} // åœ¨è¿™é‡Œæ·»åŠ æ»šåŠ¨æ›´æ–°çš„é€»è¾‘ // ä¾‹å¦‚ï¼šonScroll={handleUpdateExpandedData} /\u003e ); }; export default ExpandedRowComponent; åœ¨ExpandedRowComponentä¸­è·‘äº†updateExpandedRowDataä¹‹åï¼ŒParentComponentä¸­æ¯ä¸‰ç§’æ‰“å°çš„å†…å®¹ä¸­å¯ä»¥çœ‹åˆ°æ–°çš„æ•°æ®ï¼Œä½†æ˜¯åœ¨ExpandedRowComponentä¸­çš„è¡¨æ ¼å¹¶æœªé‡æ–°æ¸²æŸ“ ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:3:2","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":"å‚è€ƒæ–‡æ¡£ åˆ—è¡¨æ»šåŠ¨åŠ è½½: https://ant.design/components/list-cn#list-demo-infinite-load protableæ ‘çŠ¶æ•°æ®å¦‚ä½•å®ç°æ‡’åŠ è½½å­èŠ‚ç‚¹: https://github.com/ant-design/pro-components/issues/2332 æ»šåŠ¨åŠ è½½ç»„ä»¶ï¼š https://github.com/ankeetmaini/react-infinite-scroll-component.git ","date":"2024-04-11","objectID":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/:4:0","tags":[""],"title":"React Antd ProTableæ»šåŠ¨æ›´æ–°","uri":"/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["documentation"],"content":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:0:0","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"åˆ›å»ºä¸¤ä¸ªkubernetesé›†ç¾¤ cat \u003c\u003cEOF \u003e cluster01-kind.yaml kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 name: cluster01 nodes: - role: control-plane networking: podSubnet: \"10.10.0.0/16\" serviceSubnet: \"10.11.0.0/16\" EOF kind create cluster --config cluster01-kind.yaml kubectl config set-cluster kind-cluster01 --server=https://$(docker inspect -f '{{.NetworkSettings.Networks.kind.IPAddress}}' cluster01-control-plane):6443 cat \u003c\u003cEOF \u003e cluster02-kind.yaml kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 name: cluster02 nodes: - role: control-plane networking: podSubnet: \"10.20.0.0/16\" serviceSubnet: \"10.21.0.0/16\" EOF kind create cluster --config cluster02-kind.yaml kubectl config set-cluster kind-cluster02 --server=https://$(docker inspect -f '{{.NetworkSettings.Networks.kind.IPAddress}}' cluster02-control-plane):6443 ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:1:0","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"Karmada kubectl æ’ä»¶ kubectl-krew: https://krew.sigs.k8s.io/ kubectl-krew install karmada ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:2:0","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"é€šè¿‡ Karmada å‘½ä»¤è¡Œå·¥å…·å®‰è£… Karmada kubectl karmada init --context=\"kind-cluster01\" I0219 19:40:52.380107 12365 deploy.go:245] kubeconfig file: , kubernetes: https://172.18.0.2:6443 I0219 19:40:52.410975 12365 deploy.go:265] karmada apiserver ip: [172.18.0.2] I0219 19:40:52.960643 12365 cert.go:246] Generate ca certificate success. I0219 19:40:53.186575 12365 cert.go:246] Generate karmada certificate success. I0219 19:40:53.266349 12365 cert.go:246] Generate apiserver certificate success. I0219 19:40:53.436140 12365 cert.go:246] Generate front-proxy-ca certificate success. I0219 19:40:53.525006 12365 cert.go:246] Generate front-proxy-client certificate success. I0219 19:40:53.921380 12365 cert.go:246] Generate etcd-ca certificate success. I0219 19:40:54.088352 12365 cert.go:246] Generate etcd-server certificate success. I0219 19:40:54.224864 12365 cert.go:246] Generate etcd-client certificate success. I0219 19:40:54.225086 12365 deploy.go:361] download crds file:https://github.com/karmada-io/karmada/releases/download/v1.8.1/crds.tar.gz Downloading...[ 100.00% ] Download complete. I0219 19:40:56.373735 12365 deploy.go:621] Create karmada kubeconfig success. I0219 19:40:56.383437 12365 idempotency.go:267] Namespace karmada-system has been created or updated. I0219 19:40:56.420546 12365 idempotency.go:291] Service karmada-system/etcd has been created or updated. I0219 19:40:56.420606 12365 deploy.go:427] Create etcd StatefulSets I0219 19:41:43.446937 12365 deploy.go:436] Create karmada ApiServer Deployment I0219 19:41:43.461798 12365 idempotency.go:291] Service karmada-system/karmada-apiserver has been created or updated. I0219 19:42:14.479243 12365 deploy.go:451] Create karmada aggregated apiserver Deployment I0219 19:42:14.502694 12365 idempotency.go:291] Service karmada-system/karmada-aggregated-apiserver has been created or updated. I0219 19:42:36.546334 12365 idempotency.go:267] Namespace karmada-system has been created or updated. I0219 19:42:36.546669 12365 deploy.go:85] Initialize karmada bases crd resource `/etc/karmada/crds/bases` I0219 19:42:36.548480 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.563038 12365 deploy.go:250] Create CRD cronfederatedhpas.autoscaling.karmada.io successfully. I0219 19:42:36.569360 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.599014 12365 deploy.go:250] Create CRD federatedhpas.autoscaling.karmada.io successfully. I0219 19:42:36.600462 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.611881 12365 deploy.go:250] Create CRD resourceinterpretercustomizations.config.karmada.io successfully. I0219 19:42:36.613298 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.624451 12365 deploy.go:250] Create CRD resourceinterpreterwebhookconfigurations.config.karmada.io successfully. I0219 19:42:36.628038 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.639566 12365 deploy.go:250] Create CRD serviceexports.multicluster.x-k8s.io successfully. I0219 19:42:36.640702 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.654625 12365 deploy.go:250] Create CRD serviceimports.multicluster.x-k8s.io successfully. I0219 19:42:36.658436 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.720222 12365 deploy.go:250] Create CRD multiclusteringresses.networking.karmada.io successfully. I0219 19:42:36.725982 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.762646 12365 deploy.go:250] Create CRD multiclusterservices.networking.karmada.io successfully. I0219 19:42:36.783995 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.849103 12365 deploy.go:250] Create CRD clusteroverridepolicies.policy.karmada.io successfully. I0219 19:42:36.855469 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.901329 12365 deploy.go:250] Create CRD clusterpropagationpolicies.policy.karmada.io successfully. I0219 19:42:36.903346 12365 deploy.go:240] Attempting to create CRD I0219 19:42:36.918197 12365 deploy.go:250] Create CRD federatedresourc","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:3:0","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"é›†ç¾¤æ³¨å†Œ Karmada æ”¯æŒ Push å’Œ Pull ä¸¤ç§æ¨¡å¼æ¥ç®¡ç†æˆå‘˜é›†ç¾¤ã€‚ Push å’Œ Pull æ¨¡å¼çš„ä¸»è¦åŒºåˆ«åœ¨äºéƒ¨ç½²æ¸…å•æ—¶è®¿é—®æˆå‘˜é›†ç¾¤çš„æ–¹å¼ã€‚ ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:4:0","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"PUSH Mode Karmada æ§åˆ¶å¹³é¢å°†ç›´æ¥è®¿é—®æˆå‘˜é›†ç¾¤çš„ kube-apiserver ä»¥è·å–é›†ç¾¤çŠ¶æ€å¹¶éƒ¨ç½²æ¸…å•ã€‚ æ³¨å†Œ kubectl karmada join kind-cluster01 --kubeconfig=/etc/karmada/karmada-apiserver.config --cluster-kubeconfig=/root/.kube/config --cluster-context=kind-cluster01 cluster(kind-cluster01) is joined successfully kubectl karmada join kind-cluster02 --kubeconfig=/etc/karmada/karmada-apiserver.config --cluster-kubeconfig=/root/.kube/config --cluster-context=kind-cluster02 cluster(kind-cluster02) is joined successfully kubectl --kubeconfig /etc/karmada/karmada-apiserver.config get clusters NAME VERSION MODE READY AGE kind-cluster01 v1.27.3 Push True 16s kind-cluster02 v1.27.3 Push True 5s ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:4:1","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"Pull mode Karmada æ§åˆ¶å¹³é¢ä¸ä¼šè®¿é—®æˆå‘˜é›†ç¾¤ï¼Œè€Œæ˜¯å°†å…¶å§”æ‰˜ç»™åä¸º Karmada-agent çš„é¢å¤–ç»„ä»¶ã€‚ æ¯ä¸ª karmada-agent æœåŠ¡äºä¸€ä¸ªé›†ç¾¤å¹¶è´Ÿè´£ï¼š å°†é›†ç¾¤æ³¨å†Œåˆ° Karmadaï¼ˆåˆ›å»º Cluster å¯¹è±¡ï¼‰ ç»´æŠ¤é›†ç¾¤çŠ¶æ€å¹¶å‘ Karmada æŠ¥å‘Šï¼ˆæ›´æ–°é›†ç¾¤å¯¹è±¡çš„çŠ¶æ€ï¼‰ ä» Karmada æ‰§è¡Œç©ºé—´ï¼ˆå‘½åç©ºé—´ã€karmada-es-\u003cé›†ç¾¤åç§°\u003eï¼‰ç›‘è§†æ¸…å•ï¼Œå¹¶å°†ç›‘è§†çš„èµ„æºéƒ¨ç½²åˆ°ä»£ç†æœåŠ¡çš„é›†ç¾¤ã€‚ ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:4:2","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"å¤šé›†ç¾¤è°ƒåº¦ https://karmada.io/zh/docs/userguide/scheduling/resource-propagating#fieldselector æä¾› PropagationPolicy å’Œ ClusterPropagationPolicy API æ¥ä¼ æ’­èµ„æºã€‚å…³äºä¸¤ä¸ªAPIä¹‹é—´çš„å·®å¼‚ï¼Œè¯·å‚è§æ­¤å¤„ ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:5:0","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"éƒ¨ç½²æœ€ç®€å•çš„å¤šé›†ç¾¤Deployment åˆ›å»ºä¼ æ’­ç­–ç•¥ cat \u003c\u003cEOF \u003e propagationpolicy.yaml apiVersion: policy.karmada.io/v1alpha1 kind: PropagationPolicy metadata: name: propagaetion-nginx # The default namespace is `default`. spec: resourceSelectors: - apiVersion: apps/v1 kind: Deployment name: nginx # If no namespace is specified, the namespace is inherited from the parent object scope. placement: clusterAffinity: clusterNames: - kind-cluster01 EOF kubectl --kubeconfig /etc/karmada/karmada-apiserver.config apply -f propagationpolicy.yaml kubectl --kubeconfig /etc/karmada/karmada-apiserver.config create deployment nginx --image nginx kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config get deployment NAME CLUSTER READY UP-TO-DATE AVAILABLE AGE ADOPTION nginx kind-cluster01 1/1 1 1 3m36s Y kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config get pods NAME CLUSTER READY STATUS RESTARTS AGE nginx-77b4fdf86c-zxjp2 kind-cluster01 1/1 Running 0 3m36s kubectl --context kind-cluster01 get pods NAME READY STATUS RESTARTS AGE nginx-77b4fdf86c-zxjp2 1/1 Running 0 2m36s kubectl --context kind-cluster02 get pods No resources found in default namespace. æ›´æ–°ä¼ æ’­ç­–ç•¥ å¯ä»¥é€šè¿‡åº”ç”¨æ–°çš„ YAML æ–‡ä»¶æ¥æ›´æ–° propagationPolicyã€‚æ­¤ YAML æ–‡ä»¶å°†éƒ¨ç½²ä¼ æ’­åˆ° kind-cluster02 é›†ç¾¤ã€‚ cat \u003c\u003cEOF \u003e propagationpolicy-update.yaml apiVersion: policy.karmada.io/v1alpha1 kind: PropagationPolicy metadata: name: propagaetion-nginx spec: resourceSelectors: - apiVersion: apps/v1 kind: Deployment name: nginx placement: clusterAffinity: clusterNames: # Modify the selected cluster to propagate the Deployment. - kind-cluster02 EOF kubectl --kubeconfig /etc/karmada/karmada-apiserver.config apply -f propagationpolicy-update.yaml kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config get deployment NAME CLUSTER READY UP-TO-DATE AVAILABLE AGE ADOPTION nginx kind-cluster02 1/1 1 1 112s Y kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config get pods NAME CLUSTER READY STATUS RESTARTS AGE nginx-77b4fdf86c-jk5qm kind-cluster02 1/1 Running 0 99s kubectl --context kind-cluster02 get pods NAME READY STATUS RESTARTS AGE nginx-77b4fdf86c-jk5qm 1/1 Running 0 2m13s ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:5:1","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"å°†éƒ¨ç½²éƒ¨ç½²åˆ°æŒ‡å®šçš„ä¸€ç»„ç›®æ ‡é›†ç¾¤ä¸­ PropagationPolicy çš„ .spec.placement.clusterAffinity å­—æ®µè¡¨ç¤ºå¯¹ç‰¹å®šé›†ç¾¤é›†åˆçš„è°ƒåº¦é™åˆ¶ï¼Œæ²¡æœ‰è¯¥é™åˆ¶ï¼Œä»»ä½•é›†ç¾¤éƒ½å¯ä»¥æˆä¸ºè°ƒåº¦å€™é€‰è€…ã€‚ å®ƒæœ‰å››ä¸ªå­—æ®µå¯ä»¥è®¾ç½®ï¼š LabelSelector FieldSelector ClusterNames ExcludeClusters LabelSelector æ”¯æŒmatchLabelså’ŒmatchExpressionsï¼Œ åŒºåˆ«å¯ä»¥å‚è€ƒæ”¯æŒåŸºäºé›†åˆéœ€æ±‚çš„èµ„æº é…ç½®æ ‡ç­¾ kubectl --kubeconfig /etc/karmada/karmada-apiserver.config label cluster kind-cluster01 app=cluster01 kubectl --kubeconfig /etc/karmada/karmada-apiserver.config label cluster kind-cluster02 app=cluster02 kubectl --kubeconfig /etc/karmada/karmada-apiserver.config label cluster kind-cluster01 deploy-type=kind kubectl --kubeconfig /etc/karmada/karmada-apiserver.config label cluster kind-cluster02 deploy-type=kind kubectl --kubeconfig /etc/karmada/karmada-apiserver.config get cluster --show-labels NAME VERSION MODE READY AGE LABELS kind-cluster01 v1.27.3 Push True 10h app=cluster01,deploy-type=kind kind-cluster02 v1.27.3 Push True 10h app=cluster02,deploy-type=kind matchLabels cat \u003c\u003cEOF \u003e propagationpolicy-labelSelector-matchLabels.yaml apiVersion: policy.karmada.io/v1alpha1 kind: PropagationPolicy metadata: name: propagaetion-nginx spec: resourceSelectors: - apiVersion: apps/v1 kind: Deployment name: nginx placement: clusterAffinity: labelSelector: matchLabels: app: cluster01 EOF kubectl --kubeconfig /etc/karmada/karmada-apiserver.config apply -f propagationpolicy-labelSelector-matchLabels.yaml propagationpolicy.policy.karmada.io/propagaetion-nginx configured æŸ¥çœ‹é›†ç¾¤deploymentéƒ¨ç½²æƒ…å†µ kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config get deployments.apps NAME CLUSTER READY UP-TO-DATE AVAILABLE AGE ADOPTION nginx kind-cluster01 2/2 2 2 13s Y kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config get pods NAME CLUSTER READY STATUS RESTARTS AGE nginx-77b4fdf86c-s7qzm kind-cluster01 1/1 Running 0 48s nginx-77b4fdf86c-v28n5 kind-cluster01 1/1 Running 0 48s matchExpressions cat \u003c\u003cEOF \u003e propagationpolicy-labelSelector-matchExpressions.yaml apiVersion: policy.karmada.io/v1alpha1 kind: PropagationPolicy metadata: name: propagaetion-nginx spec: resourceSelectors: - apiVersion: apps/v1 kind: Deployment name: nginx placement: clusterAffinity: labelSelector: matchExpressions: - key: app operator: In values: - cluster01 - cluster02 EOF kubectl --kubeconfig /etc/karmada/karmada-apiserver.config apply -f propagationpolicy-labelSelector-matchExpressions.yaml propagationpolicy.policy.karmada.io/propagaetion-nginx configured æŸ¥çœ‹é›†ç¾¤deploymentéƒ¨ç½²æƒ…å†µ kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config get deployments.apps NAME CLUSTER READY UP-TO-DATE AVAILABLE AGE ADOPTION nginx kind-cluster01 2/2 2 2 3m34s Y nginx kind-cluster02 2/2 2 2 23s Y kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config get pods NAME CLUSTER READY STATUS RESTARTS AGE nginx-77b4fdf86c-s7qzm kind-cluster01 1/1 Running 0 3m40s nginx-77b4fdf86c-v28n5 kind-cluster01 1/1 Running 0 3m40s nginx-77b4fdf86c-dvzfx kind-cluster02 1/1 Running 0 29s nginx-77b4fdf86c-m6brd kind-cluster02 1/1 Running 0 29s FieldSelector æ”¯æŒmatchLabelså’ŒmatchExpressionsï¼Œ åŒºåˆ«å¯ä»¥å‚è€ƒæ”¯æŒåŸºäºé›†åˆéœ€æ±‚çš„èµ„æº é…ç½®Field FieldSelector æ”¯æŒä¸‰ä¸ªå€¼provider, region, zone, åˆ†åˆ«å¯¹åº”clusterå¯¹è±¡çš„.spec.provider, .spec.region, .spec.zoneçš„é€‰æ‹© bectl --kubeconfig /etc/karmada/karmada-apiserver.config patch clusters.cluster.karmada.io kind-cluster01 kind-cluster02 -p '{\"spec\": {\"provider\": \"kind\"} }' cluster.cluster.karmada.io/kind-cluster01 patched cluster.cluster.karmada.io/kind-cluster02 patched kubectl --kubeconfig /etc/karmada/karmada-apiserver.config patch clusters.cluster.karmada.io kind-cluster01 kind-cluster02 -p '{\"spec\": {\"region\": \"local\"} }' cluster.cluster.karmada.io/kind-cluster01 patched cluster.cluster.karmada.io/kind-cluster02 patched kubectl --kubeconfig /etc/karmada/karmada-apiserver.config patch clusters.cluster.karmada.io kind-cluster01 -p '{\"spec\": {\"zone\": \"cluster01\"} }' cluster.cluster.karmada.io/kind-cluster01 patched kubectl --kubeconfig /etc/karmada/karmada-apiserver.config patch clusters.cluster.karmada.io kind-cluster02 -p '{\"spec\": {\"zone\": ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:5:2","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"å¤šä¸ªé›†ç¾¤äº²å’Œæ€§ç»„ ","date":"2024-02-19","objectID":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/:5:3","tags":[""],"title":"éƒ¨ç½²k8så¤šé›†ç¾¤ç®¡ç†åˆ©å™¨Karmada","uri":"/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/"},{"categories":["documentation"],"content":"ä½¿ç”¨ WebAssembly å¯¹ Istio è¿›è¡Œæ‰©å±• ","date":"2024-01-26","objectID":"/2.wasm-istio/:0:0","tags":[""],"title":"ä½¿ç”¨ WebAssembly å¯¹ Istio è¿›è¡Œæ‰©å±•","uri":"/2.wasm-istio/"},{"categories":["documentation"],"content":"Proxy-Wasm ç¼–å†™ WASM çš„å·¥å…·æœ‰ Solo.io å›¢é˜Ÿçš„ wasmeã€tinygoç­‰ï¼Œç›®å‰åº”ç”¨æ¯”è¾ƒå¤šæ˜¯ tinygoï¼Œtinygo æ”¯æŒçš„åŒ…å¯ä»¥æŸ¥çœ‹ https://tinygo.org/docs/reference/lang-support/stdlib/ è¿›è¡Œäº†è§£ã€‚ TinyGo æ˜¯ Go ç¼–ç¨‹è¯­è¨€è§„èŒƒçš„ä¸€ä¸ªç¼–è¯‘å™¨å®ç°ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨å®˜æ–¹çš„ Go ç¼–è¯‘å™¨ï¼Ÿç›®å‰å®˜æ–¹ç¼–è¯‘å™¨æ— æ³•ç”Ÿæˆå¯ä»¥åœ¨æµè§ˆå™¨å¤–éƒ¨è¿è¡Œçš„ WASM äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› æ­¤ä¹Ÿæ— æ³•ç”Ÿæˆä¸ Proxy-Wasm å…¼å®¹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ","date":"2024-01-26","objectID":"/2.wasm-istio/:1:0","tags":[""],"title":"ä½¿ç”¨ WebAssembly å¯¹ Istio è¿›è¡Œæ‰©å±•","uri":"/2.wasm-istio/"},{"categories":["documentation"],"content":"Proxy-Wasm Proxy-Wasmæ˜¯å¼€æºç¤¾åŒºé’ˆå¯¹ã€Œç½‘ç»œä»£ç†åœºæ™¯ã€è®¾è®¡çš„ä¸€å¥— ABI è§„èŒƒï¼Œå®šä¹‰äº†ç½‘ç»œä»£ç†å’Œè¿è¡Œåœ¨ç½‘ç»œä»£ç†å†…éƒ¨çš„ Wasm è™šæ‹Ÿæœºä¹‹é—´çš„æ¥å£ï¼Œå±äºå½“å‰çš„äº‹å®è§„èŒƒã€‚å½“å‰æ”¯æŒè¯¥è§„èŒƒçš„ç½‘ç»œä»£ç†è½¯ä»¶åŒ…æ‹¬ Envoyã€MOSN å’Œ ATS(Apache Traffic Server)ï¼Œæ”¯æŒè¯¥è§„èŒƒçš„ Wasm æ‰©å±• SDK åŒ…æ‹¬ C++ã€Rust å’Œ Goã€‚é‡‡ç”¨è¯¥è§„èŒƒçš„å¥½å¤„åœ¨äºèƒ½è®© Wasm æ‰©å±•ç¨‹åºåœ¨ä¸åŒçš„ç½‘ç»œä»£ç†äº§å“ä¸Šè¿è¡Œï¼Œæ¯”å¦‚ MOSN çš„ Wasm æ‰©å±•ç¨‹åºå¯ä»¥è¿è¡Œåœ¨ Envoy ä¸Šï¼Œè€Œ Envoy çš„ Wasm æ‰©å±•ç¨‹åºä¹Ÿå¯ä»¥è¿è¡Œåœ¨ MOSN ä¸Šã€‚ Proxy-Wasm è§„èŒƒå®šä¹‰äº†å®¿ä¸»æœºä¸ Wasm æ‰©å±•ç¨‹åºä¹‹é—´çš„äº¤äº’ç»†èŠ‚ï¼ŒåŒ…æ‹¬ API åˆ—è¡¨ã€å‡½æ•°è°ƒç”¨è§„èŒƒä»¥åŠæ•°æ®ä¼ è¾“è§„èŒƒè¿™å‡ ä¸ªæ–¹é¢ã€‚å…¶ä¸­ï¼ŒAPI åˆ—è¡¨åŒ…å«äº† L4/L7ã€propertyã€metricsã€æ—¥å¿—ç­‰æ–¹é¢çš„æ‰©å±•ç‚¹ï¼Œæ¶µç›–äº†ç½‘ç»œä»£ç†åœºæ™¯ä¸‹æ‰€éœ€çš„å¤§éƒ¨åˆ†äº¤äº’ç‚¹ã€‚ç›®å‰å®ç°è¯¥è§„èŒƒçš„ Wasm æ‰©å±• SDK åŒ…æ‹¬ AssemblyScriptã€C++ã€Rust å’Œ Goï¼š AssemblyScript SDK C++ SDK Go (TinyGo) SDK Rust SDK ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿç›´æ¥é€‰æ‹©å·²æœ‰çš„ proxy-wasm-go-sdk è¿™ä¸ª SDK è¿›è¡Œå¼€å‘ã€‚è¿™ä¸ª Proxy-Wasm Go SDK æ˜¯ç”¨äºä½¿ç”¨ Go ç¼–ç¨‹è¯­è¨€åœ¨ Proxy-Wasm ABI è§„èŒƒä¹‹ä¸Šæ‰©å±•ç½‘ç»œä»£ç†ï¼ˆä¾‹å¦‚ Envoyproxyï¼‰çš„ SDKï¼Œæœ‰äº†è¿™ä¸ª SDKï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥è½»æ¾åœ°ç”Ÿæˆä¸ Proxy-Wasm è§„èŒƒå…¼å®¹çš„ Wasm äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œæ— éœ€äº†è§£ä½çº§ä¸”å¯¹äºæ²¡æœ‰ä¸“ä¸šçŸ¥è¯†çš„äººæ¥è¯´éš¾ä»¥ç†è§£çš„ Proxy-Wasm ABI è§„èŒƒã€‚ ","date":"2024-01-26","objectID":"/2.wasm-istio/:1:1","tags":[""],"title":"ä½¿ç”¨ WebAssembly å¯¹ Istio è¿›è¡Œæ‰©å±•","uri":"/2.wasm-istio/"},{"categories":["documentation"],"content":"å‚è€ƒæ–‡æ¡£ ä½¿ç”¨ WebAssembly å¯¹ Istio è¿›è¡Œæ‰©å±• ","date":"2024-01-26","objectID":"/2.wasm-istio/:2:0","tags":[""],"title":"ä½¿ç”¨ WebAssembly å¯¹ Istio è¿›è¡Œæ‰©å±•","uri":"/2.wasm-istio/"},{"categories":["documentation"],"content":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ ","date":"2024-01-24","objectID":"/1.wasm-run/:0:0","tags":[""],"title":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ","uri":"/1.wasm-run/"},{"categories":["documentation"],"content":"ç¼–å†™WASMï¼ˆWebAssemblyï¼‰ ","date":"2024-01-24","objectID":"/1.wasm-run/:1:0","tags":[""],"title":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ","uri":"/1.wasm-run/"},{"categories":["documentation"],"content":"GO å®‰è£…tinygo https://github.com/tinygo-org/tinygo/releases wget https://github.com/tinygo-org/tinygo/releases/download/v0.30.0/tinygo0.30.0.linux-amd64.tar.gz tar xf tinygo0.30.0.linux-amd64.tar.gz -C /usr/local/ /usr/local/tinygo/bin/tinygo version tinygo version 0.30.0 linux/amd64 (using go version go1.16.9 and LLVM version 16.0.1) æš´éœ²ä¸€ä¸ªaddå‡½æ•° package main func main() {} //export add func add(a, b int) int { return a + b } buildä¸ºwasm tinygo build -o go.wasm -target=wasi go/wasm.go ","date":"2024-01-24","objectID":"/1.wasm-run/:1:1","tags":[""],"title":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ","uri":"/1.wasm-run/"},{"categories":["documentation"],"content":"rust å®‰è£…wasm-pack å°†ä»£ç ç¼–è¯‘ä¸º WebAssemblyï¼Œå¹¶ç”Ÿæˆæ­£ç¡®çš„æ‰“åŒ…ä»¥ä¾›åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ cargo install wasm-pack cargo install wasmer-cli cargo install wasm-bindgen-cli rustup target add wasm32-unknown-unknown rustup target add wasm32-wasi åˆ›å»ºä¸€ä¸ªwebAssmeblyåŒ… cargo new wasi-demo ä¿®æ”¹src/main.rs pub fn main() { } #[no_mangle] pub extern fn add(left: usize, right: usize) -\u003e usize { let sum = left + right; return sum; } ç¼–è¯‘ä¸ºwasmæ ¼å¼ wasm-pack build --target web ","date":"2024-01-24","objectID":"/1.wasm-run/:1:2","tags":[""],"title":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ","uri":"/1.wasm-run/"},{"categories":["documentation"],"content":"è¿è¡Œwasm ","date":"2024-01-24","objectID":"/1.wasm-run/:2:0","tags":[""],"title":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ","uri":"/1.wasm-run/"},{"categories":["documentation"],"content":"Goè¿è¡Œ ç¼–å†™wasmer-goè¿è¡Œä»£ç  ä¿å­˜ä¸ºsample.goæ–‡ä»¶ package main import ( \"flag\" \"fmt\" \"os\" wasmer \"github.com/wasmerio/wasmer-go/wasmer\" ) func main() { var wasmFile = flag.String(\"wasm_file\", \"go.wasm\", \"wasm file\") flag.Parse() wasmBytes, _ := os.ReadFile(*wasmFile) store := wasmer.NewStore(wasmer.NewEngine()) module, _ := wasmer.NewModule(store, wasmBytes) wasiEnv, _ := wasmer.NewWasiStateBuilder(\"wasi-program\"). // Choose according to your actual situation // Argument(\"--foo\"). // Environment(\"ABC\", \"DEF\"). // MapDirectory(\"./\", \".\"). Finalize() importObject, err := wasiEnv.GenerateImportObject(store, module) check(err) instance, err := wasmer.NewInstance(module, importObject) check(err) start, err := instance.Exports.GetWasiStartFunction() check(err) start() add, err := instance.Exports.GetFunction(\"add\") check(err) result, _ := add(1, 2) fmt.Println(result) } func check(e error) { if e != nil { panic(e) } } ","date":"2024-01-24","objectID":"/1.wasm-run/:2:1","tags":[""],"title":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ","uri":"/1.wasm-run/"},{"categories":["documentation"],"content":"è¿è¡Œ # æµ‹è¯•GOç”Ÿæˆçš„wasm $ go run sample.go --wasm_file ./go.wasm 3 # æµ‹è¯•rustç”Ÿæˆçš„wasm $ go run sample.go --wasm_file wasi-demo/target/wasm32-wasi/release/wasi-demo.wasm 3 ","date":"2024-01-24","objectID":"/1.wasm-run/:2:2","tags":[""],"title":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ","uri":"/1.wasm-run/"},{"categories":["documentation"],"content":"å‚è€ƒæ–‡æ¡£ se https://blog.csdn.net/weixin_47560078/article/details/130559636 https://github.com/wasmerio/wasmer-go/tree/master/examples/wasi https://www.wkwkk.com/articles/1c90cd3673398f7f.html ","date":"2024-01-24","objectID":"/1.wasm-run/:3:0","tags":[""],"title":"ç¼–å†™WASM(WebAssembly)å¹¶è¿è¡Œ","uri":"/1.wasm-run/"},{"categories":["documentation"],"content":"greenvpnä»‹ç» æˆ‘å¹³å¸¸ç”¨VPNæ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥æ‰¾äº†å…è´¹çš„VPNä½¿ç”¨ï¼Œgreenvpnçš„è¯¦ç»†ä½¿ç”¨å¯ä»¥å‚è€ƒ: greenvpnæ³¨å†Œ ","date":"2024-01-21","objectID":"/core_process_is_killed/:1:0","tags":["vpn","process-monitor"],"title":"é“¾æ¥å·²æ–­å¼€ï¼Œæ ¸å¿ƒè¿›ç¨‹è¢«å…¶ä»–è½¯ä»¶æ€æ­»","uri":"/core_process_is_killed/"},{"categories":["documentation"],"content":"è¿æ¥æŠ¥é”™: é“¾æ¥å·²æ–­å¼€ï¼Œæ ¸å¿ƒè¿›ç¨‹è¢«å…¶ä»–è½¯ä»¶æ€æ­» ç»“è®º: åœ¨ä½¿ç”¨greenvpnä¹‹å‰ï¼Œä½¿ç”¨äº†å…¶ä»–VPNæˆ–åœ¨é»˜å†™æƒ…å†µä¸‹å¯ç”¨äº†åŠ é€Ÿå™¨ï¼Œéœ€è¦å…ˆå°†å…¶ä»–è™šæ‹Ÿç½‘å¡å¸è½½ï¼Œç„¶åå†å°è¯•è¿æ¥ä¼šè®©å®‰è£…win10-tap-9.24.2ï¼Œå®‰è£…åç„¶åå³å¯æ­£å¸¸è¿æ¥ ","date":"2024-01-21","objectID":"/core_process_is_killed/:2:0","tags":["vpn","process-monitor"],"title":"é“¾æ¥å·²æ–­å¼€ï¼Œæ ¸å¿ƒè¿›ç¨‹è¢«å…¶ä»–è½¯ä»¶æ€æ­»","uri":"/core_process_is_killed/"},{"categories":["documentation"],"content":"è§£å†³é—®é¢˜çš„æ­¥éª¤ å‰æœŸå°è¯•æ­¥éª¤ â‘  å…³é—­å®‰å…¨è½¯ä»¶ï¼Œç¦ç”¨ç›¸å…³å®‰å…¨è½¯ä»¶å¼€æœºå¯åŠ¨ â‘¡ å…³é—­é˜²ç«å¢™ â‘¢ é‡è£…greenvpn â€¦â€¦ è§£å†³æ­¥éª¤ â‘  ç»è¿‡å’ŒChatGPTçš„å¤šæ¬¡æ²Ÿé€šï¼Œchatgptç»™æˆ‘æä¾›äº†ä¸€ä¸ªæŠ“å–è¿›ç¨‹äº‹ä»¶çš„è½¯ä»¶ï¼Œ Process Monitor chatgptå›ç­” â‘¡ é€šè¿‡å¾®è½¯å®˜æ–¹ä¸‹è½½process monitorï¼š https://learn.microsoft.com/zh-cn/sysinternals/downloads/procmon â‘¢ æ–°å¢è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤ greenvpnç›¸å…³çš„è¿›ç¨‹ è¿›ç¨‹ç›‘æ§æ­¥éª¤ â‘£ å†æ¬¡å°è¯•è¿æ¥ï¼Œå¤±è´¥åæŸ¥çœ‹process monitoræŠ“åˆ°çš„è¿›ç¨‹ è¿›ç¨‹ç›‘æ§ä¿¡æ¯ â‘£ é€šè¿‡è®¾å¤‡ç®¡ç†å™¨å°†è™šæ‹Ÿç½‘å¡å¸è½½ åŒæ—¶æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ Windows å’Œ R é”®, åœ¨è¿è¡Œå¯¹è¯æ¡†ä¸­è¾“å…¥ devmgmt.msc å¹¶æŒ‰ä¸‹ Enter é”® æ‰“å¼€è®¾å¤‡ç®¡ç†å™¨ï¼Œç„¶åæ‰“å¼€ç½‘ç»œé€‚é…å™¨ è¿›ç¨‹ç›‘æ§ä¿¡æ¯ â‘¤ å†æ¬¡è¿æ¥çš„æ—¶å€™ï¼Œä¼šæç¤ºæ²¡æœ‰è™šæ‹Ÿç½‘å¡ï¼Œç„¶åç‚¹å‡»é‡æ–°åŠ è½½ï¼Œç„¶åè¿›è¡Œwin10-tap-9.24.2çš„å®‰è£…, å®‰è£…å®Œæˆåå³å¯æ­£å¸¸è¿æ¥vpn greenvpnè™šæ‹Ÿæ¨¡å—é‡æ–°åŠ è½½ ","date":"2024-01-21","objectID":"/core_process_is_killed/:2:1","tags":["vpn","process-monitor"],"title":"é“¾æ¥å·²æ–­å¼€ï¼Œæ ¸å¿ƒè¿›ç¨‹è¢«å…¶ä»–è½¯ä»¶æ€æ­»","uri":"/core_process_is_killed/"},{"categories":["documentation"],"content":"GreenVPNæ³¨å†Œ ä¸€ã€greenvpnä¸‹è½½ å®˜ç½‘åœ°å€: GreenVPN - Free VPN Service | Free VPN Software äºŒã€æ³¨å†Œgreenvpnæ–°è´¦æˆ· ","date":"2024-01-20","objectID":"/greenvpn-register/:0:0","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"2.1 è·å–ä¸´æ—¶é‚®ç®± ä¸´æ—¶é‚®ç®±è·å–åœ°å€ï¼šæ›´æ”¹ç”µå­é‚®ä»¶åœ°å€ - Temp Mail (temp-mail.org) æ‰“å¼€é¡µé¢åï¼Œå¤åˆ¶é‚®ä»¶ï¼Œç„¶åç‚¹å‡»åˆ·æ–°ï¼ˆä¼šç­‰å¾…æ–°é‚®ä»¶çš„å‘é€ï¼‰ ","date":"2024-01-20","objectID":"/greenvpn-register/:1:0","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"2.2 æ³¨å†Œgreenvpn ","date":"2024-01-20","objectID":"/greenvpn-register/:2:0","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"é€šè¿‡webé¡µé¢æ³¨å†Œ æ‰“å¼€åœ°å€: GreenVPN - Free VPN Service | Free VPN Softwareè¾“å…¥é‚®ä»¶æ³¨å†Œå³å¯ ","date":"2024-01-20","objectID":"/greenvpn-register/:2:1","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"é€šè¿‡greenvpnå®¢æˆ·ç«¯æ³¨å†Œ å®‰è£…åç‚¹å‡»ç”¨æˆ·ç™»å½•/æ³¨å†Œè´¦æˆ·ï¼Œç„¶åç‚¹å‡»æ³¨å†Œè´¦æˆ·å³å¯ ","date":"2024-01-20","objectID":"/greenvpn-register/:2:2","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"ä½¿ç”¨powershellç»ˆç«¯å‘½ä»¤æ³¨å†Œ â‘ æ‰“å¼€ç»ˆç«¯ 1ï¼‰ç‚¹å‡»æ¡Œé¢ä¸‹æ–¹çš„WindowsæŒ‰é’®æˆ–è€…ä¿ºé”®ç›˜çš„Winé”® 2ï¼‰æœç´¢powershellæ‰“å¼€ â‘¡æ³¨å†Œè´¦æˆ· curl.exe -H \"User-Agent:Mozilla/5.0\" -H \"Content-Type:application/x-www-form-urlencoded\" -X POST \"https://www.wzjsq.xyz/regist.shtml?target=\u0026userName=jasadi1014@ibtrades.com\u0026password1=qazwsx123123\u0026password2=qazwsx123123\u0026device=web\u0026identifier=web\u0026register_submit=Sign+up\" userName=jasadi1014@ibtrades.comï¼šé‚®ç®±åœ°å€ password1=qazwsx123123ï¼šå¯†ç  password2=qazwsx123123ï¼šå¯†ç  ","date":"2024-01-20","objectID":"/greenvpn-register/:2:3","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"æ³¨å†Œ1GBæµé‡çš„è´¦æˆ· é»˜è®¤æ³¨å†Œçš„é‚®ç®±æ˜¯200MBæˆ–è€…500MB, å¦‚æœè¦æ³¨å†Œ1GBæµé‡çš„è´¦å·ï¼Œéœ€è¦ä½¿ç”¨éä¸­å›½å¤§é™†çš„IPåœ°å€. æ‰€ä»¥å¯ä»¥å…ˆæ³¨å†Œä¸€ä¸ªæ­£å¸¸çš„è´¦æˆ·ï¼Œç„¶åè¿æ¥VPNåé€šè¿‡éå¤§é™†çš„IPå†æ¬¡è¿›è¡Œè´¦å·æ³¨å†Œï¼Œå³å¯æ³¨å†Œ1GBæµé‡çš„è´¦æˆ· â‘  è¿æ¥VPNåä½¿ç”¨WEBé¡µé¢æ³¨å†Œ â‘¡ ä½¿ç”¨powershellå‘½ä»¤è¡Œæ—¶ï¼Œå¢åŠ VPNä»£ç† -x æ˜¯æŒ‡å®šä»£ç†çš„å‘½ä»¤ï¼Œgreenvpnä¼šé»˜è®¤ç›‘å¬8080ä½œä¸ºä»£ç†ç«¯å£ curl.exe -x 127.0.0.1:8080 -H \"User-Agent:Mozilla/5.0\" -H \"Content-Type:application/x-www-form-urlencoded\" -X POST \"https://www.wzjsq.xyz/regist.shtml?target=\u0026userName=jasadi1014@ibtrades.com\u0026password1=qazwsx123123\u0026password2=qazwsx123123\u0026device=web\u0026identifier=web\u0026register_submit=Sign+up\" ","date":"2024-01-20","objectID":"/greenvpn-register/:2:4","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"greenvpnçš„åŠ é€Ÿç±»å‹æœ‰\"ç½‘é¡µ/è§†é¢‘\", â€œè½¯ä»¶/æ¸¸æˆâ€ ç½‘é¡µ/è§†é¢‘ åŸç†æ˜¯åœ¨\"internetå±æ€§â€“\u003eè¿æ¥â€“\u003eå±€åŸŸç½‘è®¾ç½®\"ä¸­å¢åŠ ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œ å±€åŸŸç½‘è®¾ç½®-ä»£ç†æœåŠ¡å™¨ è½¯ä»¶/æ¸¸æˆ è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªç½‘å¡çº§åˆ«çš„VPNäº†ï¼Œé™¤äº†æµè§ˆå™¨ï¼Œå…¶ä»–è½¯ä»¶è®¿é—®å…¬ç½‘çš„æ—¶å€™ä¹Ÿèµ°VPN ","date":"2024-01-20","objectID":"/greenvpn-register/:2:5","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"ApiFoxè‡ªåŠ¨åŒ–é‚®ä»¶æ³¨å†Œ xuan.dong åœ¨ Apifox é‚€è¯·ä½ åŠ å…¥é¡¹ç›® temp-mail https://app.apifox.com/invite/project?token=0W6Td6HySKUkqUJPeeesP ","date":"2024-01-20","objectID":"/greenvpn-register/:3:0","tags":["vpn"],"title":"GreenVPNæ³¨å†Œ","uri":"/greenvpn-register/"},{"categories":["documentation"],"content":"ä¸€ã€istioå¤šé›†ç¾¤æ¨¡å‹ä»‹ç» Istio å¤šé›†ç¾¤ç½‘æ ¼æœ‰å¤šç§æ¨¡å‹ï¼Œåœ¨ç½‘ç»œæ‹“æ‰‘ä¸Šåˆ†ä¸ºæ‰å¹³ç½‘ç»œå’Œéæ‰å¹³ç½‘ç»œï¼Œåœ¨æ§åˆ¶é¢ä¸Šåˆ†ä¸ºå•ä¸€æ§åˆ¶å¹³é¢å’Œå¤šæ§åˆ¶å¹³é¢ã€‚ Istio å¤šé›†ç¾¤ç½‘æ ¼æœ‰å¤šç§æ¨¡å‹ï¼Œåœ¨ç½‘ç»œæ‹“æ‰‘ä¸Šåˆ†ä¸ºæ‰å¹³ç½‘ç»œå’Œéæ‰å¹³ç½‘ç»œï¼Œåœ¨æ§åˆ¶é¢ä¸Šåˆ†ä¸ºå•ä¸€æ§åˆ¶å¹³é¢å’Œå¤šæ§åˆ¶å¹³é¢ã€‚ æ‰å¹³ç½‘ç»œï¼šæ‰€æœ‰é›†ç¾¤éƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œå¯ä»¥ç›´æ¥è®¿é—®åˆ°å…¶ä»–é›†ç¾¤çš„æœåŠ¡ï¼Œä¸éœ€è¦é€šè¿‡ç½‘å…³ã€‚ ä¼˜ç‚¹ï¼š è·¨é›†ç¾¤è®¿é—®ä¸ç»è¿‡ä¸œè¥¿å‘ç½‘å…³ï¼Œå»¶è¿Ÿä½ ç¼ºç‚¹ï¼šç»„ç½‘è¾ƒä¸ºå¤æ‚ï¼ŒServiceã€Pod ç½‘æ®µä¸èƒ½é‡å ï¼Œå€ŸåŠ© VPN ç­‰æŠ€æœ¯å°†æ‰€æœ‰é›†ç¾¤çš„ Pod ç½‘ç»œæ‰“é€šï¼Œéœ€è¦è€ƒè™‘ç½‘ç»œå®‰å…¨é—®é¢˜ éæ‰å¹³ç½‘ç»œï¼šé›†ç¾¤ä¹‹é—´çš„ç½‘ç»œæ˜¯éš”ç¦»çš„ï¼Œéœ€è¦é€šè¿‡ç½‘å…³è®¿é—®å…¶ä»–é›†ç¾¤çš„æœåŠ¡ã€‚ ä¼˜ç‚¹ï¼šä¸åŒé›†ç¾¤çš„ç½‘ç»œæ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œå®‰å…¨æ€§æ›´é«˜ï¼Œä¸éœ€è¦æ‰“é€šä¸åŒé›†ç¾¤çš„å®¹å™¨ç½‘ç»œï¼Œä¸ç”¨æå‰è§„åˆ’é›†ç¾¤çš„ç½‘æ®µ ç¼ºç‚¹ï¼šè·¨é›†ç¾¤è®¿é—®ä¾èµ–ä¸œè¥¿å‘ç½‘å…³ï¼Œå»¶è¿Ÿé«˜ã€‚ä¸œè¥¿å‘ç½‘å…³å·¥ä½œæ¨¡å¼æ˜¯ TLS AUTO_PASSTHROUGHï¼Œä¸æ”¯æŒ HTTP è·¯ç”±ç­–ç•¥ã€‚ å•æ§åˆ¶é¢ï¼šæ‰€æœ‰é›†ç¾¤å…±ç”¨ä¸€ä¸ªæ§åˆ¶å¹³é¢ï¼Œæ‰€æœ‰é›†ç¾¤çš„é…ç½®éƒ½åœ¨åŒä¸€ä¸ªæ§åˆ¶å¹³é¢ä¸­ã€‚ ä¼˜ç‚¹ï¼šæ‰€æœ‰é›†ç¾¤çš„é…ç½®éƒ½åœ¨åŒä¸€ä¸ªæ§åˆ¶å¹³é¢ä¸­ï¼Œé›†ç¾¤ä¹‹é—´çš„é…ç½®å¯ä»¥å…±äº«ï¼Œéƒ¨ç½²è¿ç»´æ›´ç®€å• ç¼ºç‚¹ï¼šæ§åˆ¶å¹³é¢çš„æ€§èƒ½å’Œå¯ç”¨æ€§ä¼šå—åˆ°å½±å“ï¼Œä¸é€‚åˆå¤§è§„æ¨¡é›†ç¾¤ å¤šæ§åˆ¶é¢ï¼šæ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ§åˆ¶å¹³é¢ï¼Œé›†ç¾¤ä¹‹é—´çš„é…ç½®ä¸å…±äº«ã€‚ ä¼˜ç‚¹ï¼šæ§åˆ¶å¹³é¢çš„æ€§èƒ½å’Œå¯ç”¨æ€§ä¸ä¼šå—åˆ°å½±å“ï¼Œé€‚åˆå¤§è§„æ¨¡é›†ç¾¤ ç¼ºç‚¹ï¼šé›†ç¾¤ä¹‹é—´çš„é…ç½®ä¸å…±äº«ï¼Œéƒ¨ç½²è¿ç»´è¾ƒä¸ºå¤æ‚ æ€»ä½“æ¥è¯´ Istio ç›®å‰æ”¯æŒ 4 ç§å¤šé›†ç¾¤æ¨¡å‹ï¼šæ‰å¹³ç½‘ç»œå•æ§åˆ¶é¢(ä¸»ä»æ¶æ„)ã€æ‰å¹³ç½‘ç»œå¤šæ§åˆ¶é¢(å¤šä¸»æ¶æ„)ã€éæ‰å¹³ç½‘ç»œå•æ§åˆ¶é¢(è·¨ç½‘ç»œä¸»ä»æ¶æ„)ã€éæ‰å¹³ç½‘ç»œå¤šæ§åˆ¶é¢(è·¨ç½‘ç»œå¤šä¸»æ¶æ„)ã€‚å…¶ä¸­æ‰å¹³ç½‘ç»œå•æ§åˆ¶é¢æ˜¯æœ€ç®€å•çš„æ¨¡å‹ï¼Œéæ‰å¹³ç½‘ç»œå¤šæ§åˆ¶é¢æ˜¯æœ€å¤æ‚çš„æ¨¡å‹ã€‚ ","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:1:0","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"äºŒã€å‡†å¤‡å·¥ä½œ ","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:2:0","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"åˆ›å»ºä¸¤ä¸ªé›†ç¾¤ cluster01 cat \u003c\u003cEOF \u003e cluster01-kind.yaml kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 name: cluster01 nodes: - role: control-plane networking: podSubnet: \"10.10.0.0/16\" serviceSubnet: \"10.11.0.0/16\" EOF kind create cluster --config cluster01-kind.yaml # kindé»˜è®¤åœ¨kubeconfigä¸­ç”Ÿæˆçš„åœ°å€æ˜¯https://127.0.0.1:xxxxxï¼Œéœ€è¦æŠŠåœ°å€æ”¹ä¸ºå®¹å™¨çš„IPåœ°å€ï¼Œå¦åˆ™ä¸¤ä¸ªé›†ç¾¤æ— æ³•è®¿é—® kubectl config set-cluster kind-cluster01 --server=https://$(docker inspect -f '{{.NetworkSettings.Networks.kind.IPAddress}}' cluster01-control-plane):6443 kubectl --context kind-cluster01 apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.12/config/manifests/metallb-native.yaml # ç­‰å¾…pod ready sleep 10 \u0026\u0026 kubectl --context kind-cluster01 -n metallb-system wait --for=condition=Ready pods -l app=metallb --timeout=600s cat \u003c\u003cEOF | kubectl --context kind-cluster01 create -f - apiVersion: metallb.io/v1beta1 kind: IPAddressPool metadata: name: custom-172.168.11.0-255 namespace: metallb-system spec: addresses: - 172.18.11.0-172.18.11.255 --- apiVersion: metallb.io/v1beta1 kind: L2Advertisement metadata: name: empty namespace: metallb-system EOF cluster02 cat \u003c\u003cEOF \u003e cluster02-kind.yaml kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 name: cluster02 nodes: - role: control-plane networking: podSubnet: \"10.20.0.0/16\" serviceSubnet: \"10.21.0.0/16\" EOF kind create cluster --config cluster02-kind.yaml kubectl config set-cluster kind-cluster02 --server=https://$(docker inspect -f '{{.NetworkSettings.Networks.kind.IPAddress}}' cluster02-control-plane):6443 kubectl --context kind-cluster02 apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.12/config/manifests/metallb-native.yaml sleep 10 \u0026\u0026 kubectl --context kind-cluster02 -n metallb-system wait --for=condition=Ready pods -l app=metallb --timeout=600s cat \u003c\u003cEOF | kubectl create --context kind-cluster02 -f - apiVersion: metallb.io/v1beta1 kind: IPAddressPool metadata: name: custom-172.168.12.0-255 namespace: metallb-system spec: addresses: - 172.18.12.0-172.18.12.255 --- apiVersion: metallb.io/v1beta1 kind: L2Advertisement metadata: name: empty namespace: metallb-system EOF ","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:2:1","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"é…ç½®ä¿¡ä»»å…³ç³» é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio CA ä¼šç”Ÿæˆä¸€ä¸ªè‡ªç­¾åçš„æ ¹è¯ä¹¦å’Œå¯†é’¥ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ¥ç­¾ç½²å·¥ä½œè´Ÿè½½è¯ä¹¦ã€‚ ä¸ºäº†ä¿æŠ¤æ ¹ CA å¯†é’¥ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨åœ¨å®‰å…¨æœºå™¨ä¸Šç¦»çº¿è¿è¡Œçš„æ ¹ CAï¼Œå¹¶ä½¿ç”¨æ ¹ CA å‘è¿è¡Œåœ¨æ¯ä¸ªé›†ç¾¤ä¸Šçš„ Istio CA ç­¾å‘ä¸­é—´è¯ä¹¦ã€‚Istio CA å¯ä»¥ä½¿ç”¨ç®¡ç†å‘˜æŒ‡å®šçš„è¯ä¹¦å’Œå¯†é’¥æ¥ç­¾ç½²å·¥ä½œè´Ÿè½½è¯ä¹¦ï¼Œ å¹¶å°†ç®¡ç†å‘˜æŒ‡å®šçš„æ ¹è¯ä¹¦ä½œä¸ºä¿¡ä»»æ ¹åˆ†é…ç»™å·¥ä½œè´Ÿè½½ã€‚ ä¸‹å›¾å±•ç¤ºäº†åœ¨åŒ…å«ä¸¤ä¸ªé›†ç¾¤çš„ç½‘æ ¼ä¸­æ¨èçš„ CA å±‚æ¬¡ç»“æ„ã€‚ CAå±‚æ¬¡ç»“æ„ Makefile.k8s.mkï¼šåŸºäº k8s é›†ç¾¤ä¸­çš„ root-ca åˆ›å»ºè¯ä¹¦ã€‚é»˜è®¤ kubeconfig ä¸­çš„å½“å‰ä¸Šä¸‹æ–‡ç”¨äºè®¿é—®é›†ç¾¤ã€‚ Makefile.selfsigned.mkï¼šåŸºäºç”Ÿæˆçš„è‡ªç­¾åæ ¹åˆ›å»ºè¯ä¹¦ã€‚ ä¸‹è¡¨æè¿°äº†ä¸¤ä¸ª Makefile æ”¯æŒçš„ç›®æ ‡ Make Target Makefile Description root-ca Makefile.selfsigned.mk ç”Ÿæˆè‡ªç­¾åæ ¹ CA å¯†é’¥å’Œè¯ä¹¦. fetch-root-ca Makefile.k8s.mk ä½¿ç”¨é»˜è®¤ kubeconfig ä¸­çš„å½“å‰ä¸Šä¸‹æ–‡ä» Kubernetes é›†ç¾¤è·å– Istio CA. $NAME-cacerts Both ä¸ºå…·æœ‰ $NAME çš„é›†ç¾¤æˆ–è™šæ‹Ÿæœºï¼ˆä¾‹å¦‚ us-eastã€cluster01 ç­‰ï¼‰ç”Ÿæˆç”±æ ¹ CA ç­¾åçš„ä¸­é—´è¯ä¹¦ã€‚å®ƒä»¬å­˜å‚¨åœ¨ $NAME ç›®å½•ä¸‹ã€‚ä¸ºäº†åŒºåˆ†é›†ç¾¤ï¼Œæˆ‘ä»¬åœ¨è¯ä¹¦ä¸»é¢˜å­—æ®µä¸­åŒ…å«ä½ç½® (L) åç§°ä»¥åŠé›†ç¾¤åç§°ã€‚ $NAMESPACE-certs Both ä½¿ç”¨æ ¹è¯ä¹¦ä¸ºä½¿ç”¨ serviceAccount $SERVICE_ACCOUNT è¿æ¥åˆ°å‘½åç©ºé—´ $NAMESPACE çš„è™šæ‹Ÿæœºç”Ÿæˆä¸­é—´è¯ä¹¦å’Œç­¾åè¯ä¹¦ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ $NAMESPACE ç›®å½•ä¸‹ã€‚ clean Both åˆ é™¤ä»»ä½•ç”Ÿæˆçš„æ ¹è¯ä¹¦ã€å¯†é’¥å’Œä¸­é—´æ–‡ä»¶ã€‚. åˆ›å»ºä¸€ä¸ªç›®å½•æ¥å­˜æ”¾è¯ä¹¦å’Œå¯†é’¥ å¦‚æœæ‚¨è®¡åˆ’ä»…éƒ¨ç½²ä¸€ä¸ªä¸»é›†ç¾¤ï¼ˆå³é‡‡ç”¨æœ¬åœ°â€”â€”è¿œç¨‹éƒ¨ç½²çš„æ–¹å¼ï¼‰ï¼Œæ‚¨å°†åªæœ‰ä¸€ä¸ª CA ï¼ˆå³ä½¿ç”¨ cluster01 ä¸Šçš„ istiod ï¼‰ä¸ºä¸¤ä¸ªé›†ç¾¤é¢å‘è¯ä¹¦ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è·³è¿‡ä»¥ä¸‹ CA è¯ä¹¦ç”Ÿæˆæ­¥éª¤ï¼Œ å¹¶ä¸”åªéœ€ä½¿ç”¨é»˜è®¤è‡ªç­¾åçš„ CA è¿›è¡Œå®‰è£…ã€‚ mkdir -p certs pushd certs ç”Ÿæˆæ ¹CAè¯ä¹¦ make -f ../tools/certs/Makefile.selfsigned.mk root-ca å°†ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š root-cert.pemï¼šç”Ÿæˆçš„æ ¹è¯ä¹¦ root-key.pemï¼šç”Ÿæˆçš„æ ¹å¯†é’¥ root-ca.confï¼šç”Ÿæˆæ ¹è¯ä¹¦çš„ openssl é…ç½® root-cert.csrï¼šä¸ºæ ¹è¯ä¹¦ç”Ÿæˆçš„ CSR ä¸ºclusterç”Ÿæˆè¯ä¹¦ make -f ../tools/certs/Makefile.selfsigned.mk cluster01-cacerts make -f ../tools/certs/Makefile.selfsigned.mk cluster02-cacerts è¿è¡Œä»¥ä¸Šå‘½ä»¤ï¼Œå°†ä¼šåœ¨åä¸º cluster01ã€cluster02 çš„ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š ca-cert.pemï¼šç”Ÿæˆçš„ä¸­é—´è¯ä¹¦ ca-key.pemï¼šç”Ÿæˆçš„ä¸­é—´å¯†é’¥ cert-chain.pemï¼šistiod ä½¿ç”¨çš„ç”Ÿæˆçš„è¯ä¹¦é“¾ root-cert.pemï¼šæ ¹è¯ä¹¦ åˆ›å»ºcacerts Secret kubectl --context kind-cluster01 create namespace istio-system kubectl --context kind-cluster01 create secret generic cacerts -n istio-system \\ --from-file=cluster01/ca-cert.pem \\ --from-file=cluster01/ca-key.pem \\ --from-file=cluster01/root-cert.pem \\ --from-file=cluster01/cert-chain.pem kubectl --context kind-cluster02 create namespace istio-system kubectl --context kind-cluster02 create secret generic cacerts -n istio-system \\ --from-file=cluster02/ca-cert.pem \\ --from-file=cluster02/ca-key.pem \\ --from-file=cluster02/root-cert.pem \\ --from-file=cluster02/cert-chain.pem ","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:2:2","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"ä¸‰ã€istioå¤šé›†ç¾¤éƒ¨ç½² ","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:3:0","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"æ‰å¹³ç½‘ç»œå•æ§åˆ¶é¢(ä¸»ä»æ¶æ„) https://istio.io/latest/zh/docs/setup/install/multicluster/primary-remote/ è¯¥æ¨¡å‹ä¸‹åªéœ€è¦å°† Istio æ§åˆ¶é¢ç»„ä»¶éƒ¨ç½²åœ¨ä¸»é›†ç¾¤ä¸­ï¼Œç„¶åå¯ä»¥é€šè¿‡è¿™ä¸ªæ§åˆ¶é¢æ¥ç®¡ç†æ‰€æœ‰é›†ç¾¤çš„ Service å’Œ Endpointï¼Œå…¶ä»–çš„ Istio ç›¸å…³çš„ API æ¯”å¦‚ VirtualServiceã€DestinationRule ç­‰ä¹Ÿåªéœ€è¦åœ¨ä¸»é›†ç¾¤ä¸­é…ç½®å³å¯ï¼Œå…¶ä»–é›†ç¾¤ä¸éœ€è¦éƒ¨ç½² Istio æ§åˆ¶é¢ç»„ä»¶ã€‚ æ§åˆ¶å¹³é¢çš„ Istiod æ ¸å¿ƒç»„ä»¶è´Ÿè´£è¿æ¥æ‰€æœ‰é›†ç¾¤çš„ kube-apiserverï¼Œè·å–æ¯ä¸ªé›†ç¾¤çš„ Serviceã€Endpointã€Pod ç­‰ä¿¡æ¯ï¼Œæ‰€æœ‰é›†ç¾¤çš„ Sidecar å‡è¿æ¥åˆ°è¿™ä¸ªä¸­å¿ƒæ§åˆ¶é¢ï¼Œç”±è¿™ä¸ªä¸­å¿ƒæ§åˆ¶é¢è´Ÿè´£æ‰€æœ‰çš„ Envoy Sidecar çš„é…ç½®ç”Ÿæˆå’Œåˆ†å‘ã€‚ ä¸»ä»æ¶æ„çš„å®‰è£… å¤šé›†ç¾¤æ‰å¹³ç½‘ç»œæ¨¡å‹å’Œå•ä¸€é›†ç¾¤çš„æœåŠ¡ç½‘æ ¼åœ¨è®¿é—®æ–¹å¼ä¸Šå‡ ä¹æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ä¸åŒé›†ç¾¤çš„ Service IP å’Œ Pod çš„ IP ä¸èƒ½é‡å ï¼Œå¦åˆ™ä¼šå¯¼è‡´é›†ç¾¤ä¹‹é—´çš„æœåŠ¡å‘ç°å‡ºç°é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯æ‰å¹³ç½‘ç»œæ¨¡å‹çš„ä¸€ä¸ªç¼ºç‚¹ï¼Œéœ€è¦æå‰è§„åˆ’å¥½é›†ç¾¤çš„ç½‘æ®µã€‚ å°† cluster01 è®¾ä¸ºä¸»é›†ç¾¤ cat \u003c\u003cEOF \u003e cluster01.yaml apiVersion: install.istio.io/v1alpha1 kind: IstioOperator spec: meshConfig: accessLogFile: /dev/stdout accessLogEncoding: JSON accessLogFormat: '{\"authority\":\"%REQ(:AUTHORITY)%\",\"bytes_received\":\"%BYTES_RECEIVED%\",\"bytes_sent\":\"%BYTES_SENT%\",\"downstream_local_address\":\"%DOWNSTREAM_LOCAL_ADDRESS%\",\"downstream_remote_address\":\"%DOWNSTREAM_REMOTE_ADDRESS%\",\"duration\":\"%DURATION%\",\"istio_policy_status\":\"%DYNAMIC_METADATA(istio.mixer:status)%\",\"method\":\"%REQ(:METHOD)%\",\"path\":\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\"protocol\":\"%PROTOCOL%\",\"request_id\":\"%REQ(X-REQUEST-ID)%\",\"requested_server_name\":\"%REQUESTED_SERVER_NAME%\",\"response_code\":\"%RESPONSE_CODE%\",\"response_flags\":\"%RESPONSE_FLAGS%\",\"route_name\":\"%ROUTE_NAME%\",\"start_time\":\"%START_TIME%\",\"trace_id\":\"%REQ(X-B3-TRACEID)%\",\"upstream_cluster\":\"%UPSTREAM_CLUSTER%\",\"upstream_host\":\"%UPSTREAM_HOST%\",\"upstream_local_address\":\"%UPSTREAM_LOCAL_ADDRESS%\",\"upstream_service_time\":\"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\",\"upstream_transport_failure_reason\":\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\",\"user_agent\":\"%REQ(USER-AGENT)%\",\"x_forwarded_for\":\"%REQ(X-FORWARDED-FOR)%\"}' values: global: meshID: mesh1 multiCluster: clusterName: cluster01 network: network1 logAsJson: true EOF istioctl install --set values.pilot.env.EXTERNAL_ISTIOD=true --context=\"kind-cluster01\" -f cluster01.yaml -y éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ values.pilot.env.EXTERNAL_ISTIOD è¢«è®¾ç½®ä¸º true æ—¶ï¼Œ å®‰è£…åœ¨ cluster01 ä¸Šçš„æ§åˆ¶å¹³é¢ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–ä»é›†ç¾¤çš„å¤–éƒ¨æ§åˆ¶å¹³é¢ã€‚ å½“è¿™ä¸ªåŠŸèƒ½è¢«å¯ç”¨æ—¶ï¼Œistiod å°†è¯•å›¾è·å¾—é¢†å¯¼æƒé”ï¼Œå¹¶å› æ­¤ç®¡ç†å°†é™„åŠ åˆ°å®ƒçš„å¹¶ä¸”å¸¦æœ‰ é€‚å½“æ³¨è§£çš„ä»é›†ç¾¤ ï¼ˆæœ¬ä¾‹ä¸­ä¸º cluster02ï¼‰ã€‚ åœ¨ cluster01 å®‰è£…ä¸œè¥¿å‘ç½‘å…³ åœ¨ cluster01 ä¸­å®‰è£…ä¸œè¥¿å‘æµé‡ä¸“ç”¨ç½‘å…³ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ç½‘å…³å°†è¢«å…¬å¼€åˆ°äº’è”ç½‘ä¸Šã€‚ ç”Ÿäº§ç¯å¢ƒå¯èƒ½éœ€è¦å¢åŠ é¢å¤–çš„å‡†å…¥é™åˆ¶ï¼ˆå³ï¼šé€šè¿‡é˜²ç«å¢™è§„åˆ™ï¼‰æ¥é˜²æ­¢å¤–éƒ¨æ”»å‡»ã€‚ å’¨è¯¢æ‚¨çš„äº‘ä¾›åº”å•†ï¼Œäº†è§£å¯ç”¨çš„é€‰é¡¹ã€‚ /root/istio-1.18.2/samples/multicluster/gen-eastwest-gateway.sh --mesh mesh1 --cluster cluster01 --network network1 | istioctl --context=kind-cluster01 install -y -f - å¦‚æœæ§åˆ¶é¢å·²ç»å®‰è£…äº†ä¸€ä¸ªä¿®è®¢ç‰ˆï¼Œå¯åœ¨ gen-eastwest-gateway.sh å‘½ä»¤ä¸­æ·»åŠ  â€“revision rev æ ‡å¿—ã€‚ ç­‰å¾…ä¸œè¥¿å‘ç½‘å…³è·å–å¤–éƒ¨ IP åœ°å€ï¼š kubectl --context=kind-cluster01 get svc istio-eastwestgateway -n istio-system NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE istio-eastwestgateway LoadBalancer 10.96.164.163 172.18.11.1 15021:30169/TCP,15443:32267/TCP,15012:30328/TCP,15017:30664/TCP 2m7s åœ¨ cluster01 ä¸­å¼€æ”¾æ§åˆ¶å¹³é¢ åœ¨å®‰è£… cluster02 ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¼€æ”¾ cluster01 çš„æ§åˆ¶å¹³é¢ï¼Œ ä»¥ä¾¿ cluster02 ä¸­çš„æœåŠ¡èƒ½è®¿é—®åˆ°æœåŠ¡å‘ç°ï¼š kubectl apply --context=kind-cluster01 -f /root/istio-1.18.2/samples/multicluster/expose-istiod.yaml è®¾ç½®é›†ç¾¤ cluster02 çš„æ§åˆ¶å¹³é¢ æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸º istio-system å‘½åç©ºé—´æ·»åŠ æ³¨è§£æ¥è¯†åˆ«åº”ç®¡ç†é›†ç¾¤ cluster02 çš„å¤–éƒ¨æ§åˆ¶å¹³é¢ï¼š kubectl --context kind-cluster02 create namespace istio-system kubectl --context=\"kind-cluster02\" annotate namespace istio-system topology.istio.io/controlPlaneClusters=cluster01 å°† cluster02 è®¾ä¸ºä»é›†ç¾¤ ä¿å­˜ cluster01 ä¸œè¥¿å‘ç½‘å…³çš„åœ°å€ã€‚ export DISCOVERY_ADDRESS=$(kubectl --context=\"kind-cluster01\" -n istio-system get svc istio-eastwestgateway -o jsonpath='{.status.loadBalancer.ingress[0].ip}') ç°åœ¨ï¼Œä¸º cluster02 åˆ›å»ºä¸€ä¸ªä»é›†ç¾¤é…ç½®ï¼š cat \u003c\u003cEOF \u003e cluster02.yaml apiVersion: install.istio.io/v1alpha1 kind: IstioOperator spec: meshConfig: accessLogFile: /dev/stdout accessLogEncoding: JSON accessLogFormat: '{\"authority\":\"%REQ(:AUTHORITY)%\",\"bytes_received\":\"%BYTES_RECEIVED%\",\"bytes_sent\":\"%BYTES_SENT%\",\"downstream_local_address\":\"%DOWNSTREAM_LOCAL_ADDRESS%\",\"downstream_remote_address\":\"%DOWNSTREAM_REMOTE_ADDRESS%\",\"duration\":\"%DURATION%\",\"istio_policy_status\":\"%DYNAMIC_METADATA(istio.mixer:status)%\",\"method\":\"%REQ(:METHOD)%\",\"path\":\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\"protocol\":\"%PROTOCOL%\",\"request_id\":\"%REQ(X-REQUEST-ID)%\",\"requested_server_name\":\"%REQUESTED_SERV","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:3:1","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"æ‰å¹³ç½‘ç»œå¤šæ§åˆ¶é¢(å¤šä¸»æ¶æ„) https://istio.io/latest/zh/docs/setup/install/multicluster/multi-primary/ åŒä¸€ç½‘ç»œçš„å¤šä¸»é›†ç¾¤ å°† cluster01 è®¾ä¸ºä¸»é›†ç¾¤ cat \u003c\u003cEOF \u003e cluster01.yaml apiVersion: install.istio.io/v1alpha1 kind: IstioOperator spec: meshConfig: accessLogFile: /dev/stdout accessLogEncoding: JSON accessLogFormat: '{\"authority\":\"%REQ(:AUTHORITY)%\",\"bytes_received\":\"%BYTES_RECEIVED%\",\"bytes_sent\":\"%BYTES_SENT%\",\"downstream_local_address\":\"%DOWNSTREAM_LOCAL_ADDRESS%\",\"downstream_remote_address\":\"%DOWNSTREAM_REMOTE_ADDRESS%\",\"duration\":\"%DURATION%\",\"istio_policy_status\":\"%DYNAMIC_METADATA(istio.mixer:status)%\",\"method\":\"%REQ(:METHOD)%\",\"path\":\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\"protocol\":\"%PROTOCOL%\",\"request_id\":\"%REQ(X-REQUEST-ID)%\",\"requested_server_name\":\"%REQUESTED_SERVER_NAME%\",\"response_code\":\"%RESPONSE_CODE%\",\"response_flags\":\"%RESPONSE_FLAGS%\",\"route_name\":\"%ROUTE_NAME%\",\"start_time\":\"%START_TIME%\",\"trace_id\":\"%REQ(X-B3-TRACEID)%\",\"upstream_cluster\":\"%UPSTREAM_CLUSTER%\",\"upstream_host\":\"%UPSTREAM_HOST%\",\"upstream_local_address\":\"%UPSTREAM_LOCAL_ADDRESS%\",\"upstream_service_time\":\"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\",\"upstream_transport_failure_reason\":\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\",\"user_agent\":\"%REQ(USER-AGENT)%\",\"x_forwarded_for\":\"%REQ(X-FORWARDED-FOR)%\"}' values: global: meshID: mesh1 multiCluster: clusterName: cluster01 network: network1 logAsJson: true EOF å°†é…ç½®æ–‡ä»¶åº”ç”¨åˆ° cluster01ï¼š istioctl install --context=\"kind-cluster01\" -f cluster01.yaml -y å°† cluster02 è®¾ä¸ºä¸»é›†ç¾¤ cat \u003c\u003cEOF \u003e cluster02.yaml apiVersion: install.istio.io/v1alpha1 kind: IstioOperator spec: meshConfig: accessLogFile: /dev/stdout accessLogEncoding: JSON accessLogFormat: '{\"authority\":\"%REQ(:AUTHORITY)%\",\"bytes_received\":\"%BYTES_RECEIVED%\",\"bytes_sent\":\"%BYTES_SENT%\",\"downstream_local_address\":\"%DOWNSTREAM_LOCAL_ADDRESS%\",\"downstream_remote_address\":\"%DOWNSTREAM_REMOTE_ADDRESS%\",\"duration\":\"%DURATION%\",\"istio_policy_status\":\"%DYNAMIC_METADATA(istio.mixer:status)%\",\"method\":\"%REQ(:METHOD)%\",\"path\":\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\"protocol\":\"%PROTOCOL%\",\"request_id\":\"%REQ(X-REQUEST-ID)%\",\"requested_server_name\":\"%REQUESTED_SERVER_NAME%\",\"response_code\":\"%RESPONSE_CODE%\",\"response_flags\":\"%RESPONSE_FLAGS%\",\"route_name\":\"%ROUTE_NAME%\",\"start_time\":\"%START_TIME%\",\"trace_id\":\"%REQ(X-B3-TRACEID)%\",\"upstream_cluster\":\"%UPSTREAM_CLUSTER%\",\"upstream_host\":\"%UPSTREAM_HOST%\",\"upstream_local_address\":\"%UPSTREAM_LOCAL_ADDRESS%\",\"upstream_service_time\":\"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\",\"upstream_transport_failure_reason\":\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\",\"user_agent\":\"%REQ(USER-AGENT)%\",\"x_forwarded_for\":\"%REQ(X-FORWARDED-FOR)%\"}' values: global: meshID: mesh1 multiCluster: clusterName: cluster02 network: network1 logAsJson: true EOF å°†é…ç½®æ–‡ä»¶åº”ç”¨åˆ° cluster02ï¼š istioctl install --context=\"kind-cluster02\" -f cluster02.yaml -y å¼€å¯ç«¯ç‚¹å‘ç° åœ¨ cluster02 ä¸­å®‰è£…ä»é›†ç¾¤çš„ secretï¼Œè¯¥ secret æä¾› cluster01 çš„ API æœåŠ¡å™¨çš„è®¿é—®æƒé™ã€‚ istioctl create-remote-secret \\ --context=\"kind-cluster01\" \\ --name=cluster01 | \\ kubectl apply -f - --context=\"kind-cluster02\" åœ¨ cluster01 ä¸­å®‰è£…ä»é›†ç¾¤çš„ secretï¼Œè¯¥ secret æä¾› cluster02 çš„ API æœåŠ¡å™¨çš„è®¿é—®æƒé™ã€‚ istioctl create-remote-secret \\ --context=\"kind-cluster02\" \\ --name=cluster02 | \\ kubectl apply -f - --context=\"kind-cluster01\" ä¸¤ä¸ªé›†ç¾¤ç½‘ç»œæ‰“é€š docker container exec cluster01-control-plane ip route add 10.20.0.0/16 via $(docker inspect -f '{{.NetworkSettings.Networks.kind.IPAddress}}' cluster02-control-plane) dev eth0 docker container exec cluster01-control-plane ip route add 10.21.0.0/16 via $(docker inspect -f '{{.NetworkSettings.Networks.kind.IPAddress}}' cluster02-control-plane) dev eth0 docker container exec cluster02-control-plane ip route add 10.10.0.0/16 via $(docker inspect -f '{{.NetworkSettings.Networks.kind.IPAddress}}' cluster01-control-plane) dev eth0 docker container exec cluster02-control-plane ip route add 10.11.0.0/16 via $(docker inspect -f '{{.NetworkSettings.Networks.kind.IPAddress}}' cluster01-control-plane) dev eth0 åç»­æ­¥éª¤ ç°åœ¨ï¼Œæ‚¨å¯ä»¥éªŒè¯æ­¤æ¬¡å®‰è£… ","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:3:2","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"éæ‰å¹³ç½‘ç»œå•æ§åˆ¶é¢(è·¨ç½‘ç»œä¸»ä»æ¶æ„) https://istio.io/latest/zh/docs/setup/install/multicluster/primary-remote_multi-network è·¨ç½‘ç»œçš„ä¸»ä»é›†ç¾¤ ä¸º cluster01 è®¾ç½®é»˜è®¤ç½‘ç»œ kubectl --context=\"kind-cluster01\" label namespace istio-system topology.istio.io/network=network1 å°† cluster01 è®¾ä¸ºä¸»é›†ç¾¤ ä¸º cluster01 åˆ›å»º Istio é…ç½®ï¼š cat \u003c\u003cEOF \u003e cluster01.yaml apiVersion: install.istio.io/v1alpha1 kind: IstioOperator spec: meshConfig: accessLogFile: /dev/stdout accessLogEncoding: JSON accessLogFormat: '{\"authority\":\"%REQ(:AUTHORITY)%\",\"bytes_received\":\"%BYTES_RECEIVED%\",\"bytes_sent\":\"%BYTES_SENT%\",\"downstream_local_address\":\"%DOWNSTREAM_LOCAL_ADDRESS%\",\"downstream_remote_address\":\"%DOWNSTREAM_REMOTE_ADDRESS%\",\"duration\":\"%DURATION%\",\"istio_policy_status\":\"%DYNAMIC_METADATA(istio.mixer:status)%\",\"method\":\"%REQ(:METHOD)%\",\"path\":\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\"protocol\":\"%PROTOCOL%\",\"request_id\":\"%REQ(X-REQUEST-ID)%\",\"requested_server_name\":\"%REQUESTED_SERVER_NAME%\",\"response_code\":\"%RESPONSE_CODE%\",\"response_flags\":\"%RESPONSE_FLAGS%\",\"route_name\":\"%ROUTE_NAME%\",\"start_time\":\"%START_TIME%\",\"trace_id\":\"%REQ(X-B3-TRACEID)%\",\"upstream_cluster\":\"%UPSTREAM_CLUSTER%\",\"upstream_host\":\"%UPSTREAM_HOST%\",\"upstream_local_address\":\"%UPSTREAM_LOCAL_ADDRESS%\",\"upstream_service_time\":\"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\",\"upstream_transport_failure_reason\":\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\",\"user_agent\":\"%REQ(USER-AGENT)%\",\"x_forwarded_for\":\"%REQ(X-FORWARDED-FOR)%\"}' values: global: meshID: mesh1 multiCluster: clusterName: cluster01 network: network1 logAsJson: true EOF å°†é…ç½®åº”ç”¨åˆ° cluster01ï¼š istioctl install --set values.pilot.env.EXTERNAL_ISTIOD=true --context=\"kind-cluster01\" -f cluster01.yaml -y è¯·æ³¨æ„ï¼Œvalues.pilot.env.EXTERNAL_ISTIOD è®¾ç½®ä¸º trueã€‚ è¿™å°†å¯ç”¨å®‰è£…åœ¨ cluster01 ä¸Šçš„æ§åˆ¶å¹³é¢ï¼Œä½¿å…¶ä¹Ÿç”¨ä½œå…¶ä»–ä»é›†ç¾¤çš„å¤–éƒ¨æ§åˆ¶å¹³é¢ã€‚ å¯ç”¨æ­¤ç‰¹æ€§åï¼Œistiod å°†å°è¯•è·å–é¢†å¯¼é€‰ä¸¾é”ï¼Œ å¹¶å› æ­¤ç®¡ç†é€‚å½“æ³¨è§£çš„ä¸”å°†æ¥å…¥çš„ä»é›†ç¾¤ï¼ˆæ­¤å¤„ä¸º cluster02ï¼‰ã€‚ åœ¨ cluster01 å®‰è£…ä¸œè¥¿å‘ç½‘å…³ åœ¨ cluster01 å®‰è£…ä¸“ç”¨çš„ä¸œè¥¿å‘æµé‡ç½‘å…³ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ç½‘å…³å°†è¢«å…¬å¼€åˆ°äº’è”ç½‘ä¸Šã€‚ ç”Ÿäº§ç³»ç»Ÿå¯èƒ½éœ€è¦é¢å¤–çš„è®¿é—®é™åˆ¶ï¼ˆå³é€šè¿‡é˜²ç«å¢™è§„åˆ™ï¼‰æ¥é˜²æ­¢å¤–éƒ¨æ”»å‡»ã€‚ å’¨è¯¢æ‚¨çš„äº‘æœåŠ¡å•†ï¼Œäº†è§£å¯ç”¨çš„é€‰æ‹©ã€‚ /root/istio-1.18.2/samples/multicluster/gen-eastwest-gateway.sh \\ --mesh mesh1 --cluster cluster01 --network network1 | \\ istioctl --context=\"kind-cluster01\" install -y -f - å¦‚æœæ§åˆ¶å¹³é¢å·²éšç€ç‰ˆæœ¬ä¿®æ­£ä¸€èµ·å®‰è£…ï¼Œè¯·åœ¨ gen-eastwest-gateway.sh å‘½ä»¤ä¸­æ·»åŠ  â€“revision rev æ ‡å¿—ã€‚ ç­‰å¾…ä¸œè¥¿å‘ç½‘å…³è·å–å¤–éƒ¨ IP åœ°å€ï¼š $ kubectl --context=kind-cluster01 get svc istio-eastwestgateway -n istio-system NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE istio-eastwestgateway LoadBalancer 10.11.43.67 172.18.11.1 15021:31333/TCP,15443:32098/TCP,15012:31996/TCP,15017:30454/TCP 40s å¼€æ”¾ cluster01 æ§åˆ¶å¹³é¢ å®‰è£… cluster02 ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¼€æ”¾ cluster01 çš„æ§åˆ¶å¹³é¢ï¼Œ ä»¥ä¾¿ cluster02 ä¸­çš„æœåŠ¡èƒ½è®¿é—®æœåŠ¡å‘ç°ã€‚ kubectl apply --context=\"kind-cluster01\" -n istio-system -f /root/istio-1.18.2/samples/multicluster/expose-istiod.yaml ä¸º cluster02 è®¾ç½®æ§åˆ¶å¹³é¢é›†ç¾¤ å‘½åç©ºé—´ istio-system åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®é›†ç¾¤çš„ç½‘ç»œï¼š æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸º istio-system å‘½åç©ºé—´æ·»åŠ æ³¨è§£æ¥è¯†åˆ«åº”ç®¡ç† cluster02 çš„å¤–éƒ¨æ§åˆ¶å¹³é¢é›†ç¾¤ï¼š kubectl --context=\"kind-cluster02\" annotate namespace istio-system topology.istio.io/controlPlaneClusters=cluster01 å°† topology.istio.io/controlPlaneClusters å‘½åç©ºé—´æ³¨è§£è®¾ç½®ä¸º cluster01 å°†æŒ‡ç¤ºè¿è¡Œåœ¨ cluster01 ä¸Šçš„ç›¸åŒå‘½åç©ºé—´ï¼ˆæœ¬ä¾‹ä¸­ä¸º istio-systemï¼‰ä¸­çš„ istiod ç®¡ç†ä½œä¸ºä»é›†ç¾¤æ¥å…¥çš„ cluster02ã€‚ ä¸º cluster02 è®¾ç½®é»˜è®¤ç½‘ç»œ é€šè¿‡å‘ istio-system å‘½åç©ºé—´æ·»åŠ æ ‡ç­¾æ¥è®¾ç½® cluster02 çš„ç½‘ç»œï¼š kubectl --context=\"kind-cluster02\" label namespace istio-system topology.istio.io/network=network2 å°† cluster02 è®¾ä¸ºä»é›†ç¾¤ ä¿å­˜ cluster01 ä¸œè¥¿å‘ç½‘å…³çš„åœ°å€ã€‚ export DISCOVERY_ADDRESS=$(kubectl \\ --context=\"kind-cluster01\" \\ -n istio-system get svc istio-eastwestgateway \\ -o jsonpath='{.status.loadBalancer.ingress[0].ip}') ç°åœ¨ï¼Œä¸º cluster02 åˆ›å»ºä¸€ä¸ªä»é›†ç¾¤é…ç½®ï¼š cat \u003c\u003cEOF \u003e cluster02.yaml apiVersion: install.istio.io/v1alpha1 kind: IstioOperator spec: meshConfig: accessLogFile: /dev/stdout accessLogEncoding: JSON accessLogFormat: '{\"authority\":\"%REQ(:AUTHORITY)%\",\"bytes_received\":\"%BYTES_RECEIVED%\",\"bytes_sent\":\"%BYTES_SENT%\",\"downstream_local_address\":\"%DOWNSTREAM_LOCAL_ADDRESS%\",\"downstream_remote_address\":\"%DOWNSTREAM_REMOTE_ADDRESS%\",\"duration\":\"%DURATION%\",\"istio_policy_status\":\"%DYNAMIC_METADATA(istio.mixer:status)%\",\"method\":\"%REQ(:METHOD)%\",\"path\":\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\"protocol\":\"%PROTOCOL%\",\"request_id\":\"%REQ(X-REQUE","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:3:3","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"éæ‰å¹³ç½‘ç»œå¤šæ§åˆ¶é¢(è·¨ç½‘ç»œå¤šä¸»æ¶æ„) è·¨ç½‘ç»œçš„å¤šä¸»é›†ç¾¤ ä¸º cluster01 è®¾ç½®ç¼ºçœç½‘ç»œ kubectl --context=\"kind-cluster01\" label namespace istio-system topology.istio.io/network=network1 å°† cluster01 è®¾ä¸ºä¸»é›†ç¾¤ cat \u003c\u003cEOF \u003e cluster01.yaml apiVersion: install.istio.io/v1alpha1 kind: IstioOperator spec: meshConfig: accessLogFile: /dev/stdout accessLogEncoding: JSON accessLogFormat: '{\"authority\":\"%REQ(:AUTHORITY)%\",\"bytes_received\":\"%BYTES_RECEIVED%\",\"bytes_sent\":\"%BYTES_SENT%\",\"downstream_local_address\":\"%DOWNSTREAM_LOCAL_ADDRESS%\",\"downstream_remote_address\":\"%DOWNSTREAM_REMOTE_ADDRESS%\",\"duration\":\"%DURATION%\",\"istio_policy_status\":\"%DYNAMIC_METADATA(istio.mixer:status)%\",\"method\":\"%REQ(:METHOD)%\",\"path\":\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\"protocol\":\"%PROTOCOL%\",\"request_id\":\"%REQ(X-REQUEST-ID)%\",\"requested_server_name\":\"%REQUESTED_SERVER_NAME%\",\"response_code\":\"%RESPONSE_CODE%\",\"response_flags\":\"%RESPONSE_FLAGS%\",\"route_name\":\"%ROUTE_NAME%\",\"start_time\":\"%START_TIME%\",\"trace_id\":\"%REQ(X-B3-TRACEID)%\",\"upstream_cluster\":\"%UPSTREAM_CLUSTER%\",\"upstream_host\":\"%UPSTREAM_HOST%\",\"upstream_local_address\":\"%UPSTREAM_LOCAL_ADDRESS%\",\"upstream_service_time\":\"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\",\"upstream_transport_failure_reason\":\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\",\"user_agent\":\"%REQ(USER-AGENT)%\",\"x_forwarded_for\":\"%REQ(X-FORWARDED-FOR)%\"}' values: global: meshID: mesh1 multiCluster: clusterName: cluster01 network: network1 logAsJson: true EOF å°†é…ç½®æ–‡ä»¶åº”ç”¨åˆ° cluster01ï¼š istioctl install --context=\"kind-cluster01\" -f cluster01.yaml -y åœ¨ cluster01 å®‰è£…ä¸œè¥¿å‘ç½‘å…³ åœ¨ cluster01 å®‰è£…ä¸“ç”¨çš„ ä¸œè¥¿å‘ç½‘å…³ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ç½‘å…³å°†è¢«å…¬å¼€åˆ°äº’è”ç½‘ä¸Šã€‚ ç”Ÿäº§ç³»ç»Ÿå¯èƒ½éœ€è¦æ·»åŠ é¢å¤–çš„è®¿é—®é™åˆ¶ï¼ˆå³ï¼šé€šè¿‡é˜²ç«å¢™è§„åˆ™ï¼‰æ¥é˜²æ­¢å¤–éƒ¨æ”»å‡»ã€‚ å’¨è¯¢æ‚¨çš„äº‘æœåŠ¡å•†ï¼Œäº†è§£å¯ç”¨çš„é€‰æ‹©ã€‚ /root/istio-1.18.2/samples/multicluster/gen-eastwest-gateway.sh --mesh mesh1 --cluster cluster01 --network network1 | istioctl --context=kind-cluster01 install -y -f - å¦‚æœæ§åˆ¶é¢å·²ç»å®‰è£…äº†ä¸€ä¸ªä¿®è®¢ç‰ˆï¼Œå¯ä»¥åœ¨ gen-eastwest-gateway.sh å‘½ä»¤ä¸­æ·»åŠ  â€“revision rev æ ‡å¿—ã€‚ ç­‰å¾…ä¸œè¥¿å‘ç½‘å…³è¢«åˆ†é…å¤–éƒ¨ IP åœ°å€ï¼š kubectl --context=\"kind-cluster01\" get svc istio-eastwestgateway -n istio-system NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE istio-eastwestgateway LoadBalancer 10.96.135.178 172.18.11.1 15021:31259/TCP,15443:30115/TCP,15012:30290/TCP,15017:30995/TCP 61s å¼€æ”¾ cluster01 ä¸­çš„æœåŠ¡ å› ä¸ºé›†ç¾¤ä½äºä¸åŒçš„ç½‘ç»œä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªé›†ç¾¤ä¸œè¥¿å‘ç½‘å…³ä¸Šå¼€æ”¾æ‰€æœ‰æœåŠ¡ï¼ˆ*.localï¼‰ã€‚ è™½ç„¶æ­¤ç½‘å…³åœ¨äº’è”ç½‘ä¸Šæ˜¯å…¬å¼€çš„ï¼Œä½†å®ƒèƒŒåçš„æœåŠ¡åªèƒ½è¢«æ‹¥æœ‰å¯ä¿¡ mTLS è¯ä¹¦ã€å·¥ä½œè´Ÿè½½ ID çš„æœåŠ¡è®¿é—®ï¼Œ å°±åƒå®ƒä»¬å¤„äºåŒä¸€ç½‘ç»œä¸€æ ·ã€‚ kubectl --context=\"kind-cluster01\" apply -n istio-system -f /root/istio-1.18.2/samples/multicluster/expose-services.yaml ä¸º cluster02 è®¾ç½®ç¼ºçœç½‘ç»œ kubectl --context=\"kind-cluster02\" label namespace istio-system topology.istio.io/network=network2 å°† cluster02 è®¾ä¸ºä¸»é›†ç¾¤ cat \u003c\u003cEOF \u003e cluster02.yaml apiVersion: install.istio.io/v1alpha1 kind: IstioOperator spec: meshConfig: accessLogFile: /dev/stdout accessLogEncoding: JSON accessLogFormat: '{\"authority\":\"%REQ(:AUTHORITY)%\",\"bytes_received\":\"%BYTES_RECEIVED%\",\"bytes_sent\":\"%BYTES_SENT%\",\"downstream_local_address\":\"%DOWNSTREAM_LOCAL_ADDRESS%\",\"downstream_remote_address\":\"%DOWNSTREAM_REMOTE_ADDRESS%\",\"duration\":\"%DURATION%\",\"istio_policy_status\":\"%DYNAMIC_METADATA(istio.mixer:status)%\",\"method\":\"%REQ(:METHOD)%\",\"path\":\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\"protocol\":\"%PROTOCOL%\",\"request_id\":\"%REQ(X-REQUEST-ID)%\",\"requested_server_name\":\"%REQUESTED_SERVER_NAME%\",\"response_code\":\"%RESPONSE_CODE%\",\"response_flags\":\"%RESPONSE_FLAGS%\",\"route_name\":\"%ROUTE_NAME%\",\"start_time\":\"%START_TIME%\",\"trace_id\":\"%REQ(X-B3-TRACEID)%\",\"upstream_cluster\":\"%UPSTREAM_CLUSTER%\",\"upstream_host\":\"%UPSTREAM_HOST%\",\"upstream_local_address\":\"%UPSTREAM_LOCAL_ADDRESS%\",\"upstream_service_time\":\"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\",\"upstream_transport_failure_reason\":\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\",\"user_agent\":\"%REQ(USER-AGENT)%\",\"x_forwarded_for\":\"%REQ(X-FORWARDED-FOR)%\"}' values: global: meshID: mesh1 multiCluster: clusterName: cluster02 network: network2 logAsJson: true EOF å°†é…ç½®æ–‡ä»¶åº”ç”¨åˆ° cluster02ï¼š istioctl install --context=\"kind-cluster02\" -f cluster02.yaml -y åœ¨ cluster02 å®‰è£…ä¸œè¥¿å‘ç½‘å…³ åœ¨ cluster02 å®‰è£…ä¸“ç”¨çš„ ä¸œè¥¿å‘ç½‘å…³ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ç½‘å…³å°†è¢«å…¬å¼€åˆ°äº’è”ç½‘ä¸Šã€‚ ç”Ÿäº§ç³»ç»Ÿå¯èƒ½éœ€è¦æ·»åŠ é¢å¤–çš„è®¿é—®é™åˆ¶ï¼ˆå³ï¼šé€šè¿‡é˜²ç«å¢™è§„åˆ™ï¼‰æ¥é˜²æ­¢å¤–éƒ¨æ”»å‡»ã€‚ å’¨è¯¢æ‚¨çš„äº‘æœåŠ¡å•†ï¼Œäº†è§£å¯ç”¨çš„é€‰æ‹©ã€‚ /root/istio-1.18","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:3:4","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"éªŒè¯å®‰è£…ç»“æœ æˆ‘ä»¬å°†åœ¨ cluster01 å®‰è£… V1 ç‰ˆçš„ HelloWorld åº”ç”¨ç¨‹åºï¼Œ åœ¨ cluster02 å®‰è£… V2 ç‰ˆçš„ HelloWorld åº”ç”¨ç¨‹åºã€‚ å½“å¤„ç†ä¸€ä¸ªè¯·æ±‚æ—¶ï¼ŒHelloWorld ä¼šåœ¨å“åº”æ¶ˆæ¯ä¸­åŒ…å«å®ƒè‡ªèº«çš„ç‰ˆæœ¬å·ã€‚ æˆ‘ä»¬ä¹Ÿä¼šåœ¨ä¸¤ä¸ªé›†ç¾¤ä¸­å‡éƒ¨ç½² Sleep å®¹å™¨ã€‚ è¿™äº› Pod å°†è¢«ç”¨ä½œå®¢æˆ·ç«¯ï¼ˆsourceï¼‰ï¼Œå‘é€è¯·æ±‚ç»™ HelloWorldã€‚ æœ€åï¼Œé€šè¿‡æ”¶é›†è¿™äº›æµé‡æ•°æ®ï¼Œæˆ‘ä»¬å°†èƒ½è§‚æµ‹å¹¶è¯†åˆ«å‡ºæ˜¯é‚£ä¸ªé›†ç¾¤å¤„ç†äº†è¯·æ±‚ã€‚ éƒ¨ç½²æœåŠ¡ HelloWorld ä¸ºäº†æ”¯æŒä»ä»»æ„é›†ç¾¤ä¸­è°ƒç”¨ HelloWorld æœåŠ¡ï¼Œæ¯ä¸ªé›†ç¾¤çš„ DNS è§£æå¿…é¡»å¯ç”¨ ï¼ˆè¯¦ç»†ä¿¡æ¯ï¼Œå‚è§éƒ¨ç½²æ¨¡å‹ 7ï¼‰ã€‚ æˆ‘ä»¬é€šè¿‡åœ¨ç½‘æ ¼çš„æ¯ä¸€ä¸ªé›†ç¾¤ä¸­éƒ¨ç½² HelloWorld æœåŠ¡ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ é¦–å…ˆï¼Œåœ¨æ¯ä¸ªé›†ç¾¤ä¸­åˆ›å»ºå‘½åç©ºé—´ sampleï¼š kubectl create --context=\"kind-cluster01\" namespace sample kubectl create --context=\"kind-cluster02\" namespace sample ä¸ºå‘½åç©ºé—´ sample å¼€å¯ sidecar è‡ªåŠ¨æ³¨å…¥ï¼š kubectl label --context=\"kind-cluster01\" namespace sample istio-injection=enabled kubectl label --context=\"kind-cluster02\" namespace sample istio-injection=enabled åœ¨æ¯ä¸ªé›†ç¾¤ä¸­åˆ›å»º HelloWorld æœåŠ¡ï¼š kubectl apply --context=\"kind-cluster01\" \\ -f /root/istio-1.18.2/samples/helloworld/helloworld.yaml \\ -l service=helloworld -n sample kubectl apply --context=\"kind-cluster02\" \\ -f /root/istio-1.18.2/samples/helloworld/helloworld.yaml \\ -l service=helloworld -n sample éƒ¨ç½² V1 ç‰ˆçš„ HelloWorld kubectl apply --context=\"kind-cluster01\" \\ -f /root/istio-1.18.2/samples/helloworld/helloworld.yaml \\ -l version=v1 -n sample éƒ¨ç½² V2 ç‰ˆçš„ HelloWorld æŠŠåº”ç”¨ helloworld-v2 éƒ¨ç½²åˆ° cluster02ï¼š kubectl apply --context=\"kind-cluster02\" \\ -f /root/istio-1.18.2/samples/helloworld/helloworld.yaml \\ -l version=v2 -n sample éƒ¨ç½² Sleep æŠŠåº”ç”¨ Sleep éƒ¨ç½²åˆ°æ¯ä¸ªé›†ç¾¤ï¼š kubectl apply --context=\"kind-cluster01\" \\ -f /root/istio-1.18.2/samples/sleep/sleep.yaml -n sample kubectl apply --context=\"kind-cluster02\" \\ -f /root/istio-1.18.2/samples/sleep/sleep.yaml -n sample ç­‰å¾…PODå¯åŠ¨æˆæœ¬ kubectl --context kind-cluster01 -n sample wait --for=condition=Ready pods -l topology.istio.io/network=network1 --timeout=600s kubectl --context kind-cluster02 -n sample wait --for=condition=Ready pods -l topology.istio.io/network=network2 --timeout=600s éªŒè¯è·¨é›†ç¾¤æµé‡ è¦éªŒè¯è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼Œéœ€è¦ç”¨ Sleep pod é‡å¤è°ƒç”¨æœåŠ¡ HelloWorldã€‚ ä¸ºäº†ç¡®è®¤è´Ÿè½½å‡è¡¡æŒ‰é¢„æœŸå·¥ä½œï¼Œéœ€è¦ä»æ‰€æœ‰é›†ç¾¤è°ƒç”¨æœåŠ¡ HelloWorldã€‚ ä» cluster01 ä¸­çš„ Sleep pod å‘é€è¯·æ±‚ç»™æœåŠ¡ HelloWorld, é‡å¤å‡ æ¬¡è¿™ä¸ªè¯·æ±‚ï¼ŒéªŒè¯ HelloWorld çš„ç‰ˆæœ¬åœ¨ v1 å’Œ v2 ä¹‹é—´åˆ‡æ¢ï¼š for i in $(seq 10);do kubectl exec --context=\"kind-cluster01\" -n sample -c sleep \"$(kubectl get pod --context=\"kind-cluster01\" -n sample -l app=sleep -o jsonpath='{.items[0].metadata.name}')\" -- curl -s helloworld.sample:5000/hello;done Hello version: v1, instance: helloworld-v1-94b6f7986-twskx Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v1, instance: helloworld-v1-94b6f7986-twskx Hello version: v1, instance: helloworld-v1-94b6f7986-twskx Hello version: v1, instance: helloworld-v1-94b6f7986-twskx Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz ç°åœ¨ï¼Œç”¨ cluster02 ä¸­çš„ Sleep pod é‡å¤æ­¤è¿‡ç¨‹ï¼Œé‡å¤å‡ æ¬¡è¿™ä¸ªè¯·æ±‚ï¼ŒéªŒè¯ HelloWorld çš„ç‰ˆæœ¬åœ¨ v1 å’Œ v2 ä¹‹é—´åˆ‡æ¢ï¼š for i in $(seq 10);do kubectl exec --context=\"kind-cluster02\" -n sample -c sleep \"$(kubectl get pod --context=\"kind-cluster02\" -n sample -l app=sleep -o jsonpath='{.items[0].metadata.name}')\" -- curl -s helloworld.sample:5000/hello;done Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v1, instance: helloworld-v1-94b6f7986-twskx Hello version: v1, instance: helloworld-v1-94b6f7986-twskx Hello version: v1, instance: helloworld-v1-94b6f7986-twskx Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v1, instance: helloworld-v1-94b6f7986-twskx Hello version: v2, instance: helloworld-v2-f976ddc5b-c6ptz Hello version: v1, instance: helloworld-v1-94b6f7986-twskx ","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:3:5","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":"å‚è€ƒæ–‡æ¡£ å®˜æ–¹æ–‡æ¡£: å¤šé›†ç¾¤å®‰è£… k8sæŠ€æœ¯åœˆï¼šIstioå¤šé›†ç¾¤å®è·µ metallb: Installation By Manifest ","date":"2024-01-15","objectID":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/:4:0","tags":["kubernetes","istio"],"title":"istioå¤šé›†ç¾¤å®‰è£…","uri":"/istio%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"},{"categories":["documentation"],"content":" æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ zhuanlan.zhihu.com æœ¬æ–‡æ‘˜è‡ª istio å­¦ä¹ ç¬”è®° ","date":"2023-12-28","objectID":"/426%E7%8A%B6%E6%80%81%E7%A0%81/:0:0","tags":[""],"title":"istio å¸¸è§é—®é¢˜: è¿”å› 426 çŠ¶æ€ç ","uri":"/426%E7%8A%B6%E6%80%81%E7%A0%81/"},{"categories":["documentation"],"content":"èƒŒæ™¯ Istio ä½¿ç”¨ Envoy ä½œä¸ºæ•°æ®é¢è½¬å‘ HTTP è¯·æ±‚ï¼Œè€Œ Envoy é»˜è®¤è¦æ±‚ä½¿ç”¨ HTTP/1.1 æˆ– HTTP/2ï¼Œå½“å®¢æˆ·ç«¯ä½¿ç”¨ HTTP/1.0 æ—¶å°±ä¼šè¿”å› 426 Upgrade Requiredã€‚ ","date":"2023-12-28","objectID":"/426%E7%8A%B6%E6%80%81%E7%A0%81/:1:0","tags":[""],"title":"istio å¸¸è§é—®é¢˜: è¿”å› 426 çŠ¶æ€ç ","uri":"/426%E7%8A%B6%E6%80%81%E7%A0%81/"},{"categories":["documentation"],"content":"å¸¸è§çš„ nginx åœºæ™¯ å¦‚æœç”¨ nginx è¿›è¡Œ proxy_pass åå‘ä»£ç†ï¼Œé»˜è®¤ä¼šç”¨ HTTP/1.0ï¼Œä½ å¯ä»¥æ˜¾ç¤ºæŒ‡å®š proxy_http_version ä¸º 1.1: upstream http_backend { server 127.0.0.1:8080; keepalive 16; } server { ... location /http/ { proxy_pass http://http_backend; proxy_http_version 1.1; proxy_set_header Connection \"\"; ... } } ","date":"2023-12-28","objectID":"/426%E7%8A%B6%E6%80%81%E7%A0%81/:2:0","tags":[""],"title":"istio å¸¸è§é—®é¢˜: è¿”å› 426 çŠ¶æ€ç ","uri":"/426%E7%8A%B6%E6%80%81%E7%A0%81/"},{"categories":["documentation"],"content":"å‹æµ‹åœºæ™¯ ab å‹æµ‹æ—¶ä¼šå‘é€ HTTP/1.0 çš„è¯·æ±‚ï¼ŒEnvoy å›ºå®šè¿”å› 426 Upgrade Requiredï¼Œæ ¹æœ¬ä¸ä¼šè¿›è¡Œè½¬å‘ï¼Œæ‰€ä»¥å‹æµ‹çš„ç»“æœä¹Ÿä¸ä¼šå‡†ç¡®ã€‚å¯ä»¥æ¢æˆå…¶å®ƒå‹æµ‹å·¥å…·ï¼Œå¦‚ wrk ã€‚ ","date":"2023-12-28","objectID":"/426%E7%8A%B6%E6%80%81%E7%A0%81/:3:0","tags":[""],"title":"istio å¸¸è§é—®é¢˜: è¿”å› 426 çŠ¶æ€ç ","uri":"/426%E7%8A%B6%E6%80%81%E7%A0%81/"},{"categories":["documentation"],"content":"è®© istio æ”¯æŒ HTTP/1.0 æœ‰äº› SDK æˆ–æ¡†æ¶å¯èƒ½ä¼šä½¿ç”¨ HTTP/1.0 åè®®ï¼Œæ¯”å¦‚ä½¿ç”¨ HTTP/1.0 å»èµ„æºä¸­å¿ƒ / é…ç½®ä¸­å¿ƒ æ‹‰å–é…ç½®ä¿¡æ¯ï¼Œåœ¨ä¸æƒ³æ”¹åŠ¨ä»£ç çš„æƒ…å†µä¸‹è®©æœåŠ¡è·‘åœ¨ istio ä¸Šï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ istiod é…ç½®ï¼ŒåŠ ä¸Š PILOT_HTTP10: 1 çš„ç¯å¢ƒå˜é‡æ¥å¯ç”¨ HTTP/1.0ã€‚ ","date":"2023-12-28","objectID":"/426%E7%8A%B6%E6%80%81%E7%A0%81/:4:0","tags":[""],"title":"istio å¸¸è§é—®é¢˜: è¿”å› 426 çŠ¶æ€ç ","uri":"/426%E7%8A%B6%E6%80%81%E7%A0%81/"},{"categories":["documentation"],"content":"å‚è€ƒèµ„æ–™ Envoy wonâ€™t connect to my HTTP/1.0 service ","date":"2023-12-28","objectID":"/426%E7%8A%B6%E6%80%81%E7%A0%81/:5:0","tags":[""],"title":"istio å¸¸è§é—®é¢˜: è¿”å› 426 çŠ¶æ€ç ","uri":"/426%E7%8A%B6%E6%80%81%E7%A0%81/"},{"categories":["documentation"],"content":" æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ www.jianshu.com æœ¬æ–‡ç»“åˆåŸŸåè¯·æ±‚æ…¢çš„é—®é¢˜ï¼Œä»è™šæ‹Ÿç½‘ç»œå®šä½åˆ°åŸŸåè§£æï¼Œæ ¹æ® coredns æ·»åŠ åŸŸååç¼€çš„æœºåˆ¶ï¼Œå®šä½ coredns è§£ææ…¢çš„æ ¹å› ã€‚ é—®é¢˜ç°è±¡ ======= èƒŒæ™¯ï¼šé¡¹ç›®æ˜¯å¾®æœåŠ¡ + flinkï¼Œå…¶ä¸­ flink é‡‡ç”¨ k8s session standalone çš„éƒ¨ç½²æ¨¡å¼ã€‚ é—®é¢˜ï¼šå¾®æœåŠ¡é€šè¿‡ flink restful api å¯åŠ¨ä½œä¸šçš„å¹³å‡æ—¶é•¿è¶…è¿‡ 40sï¼Œå¯¼è‡´å®¢æˆ·ç«¯è¶…æ—¶å’Œä½œä¸šå¤±è”ã€‚ #ä¸ºäº†æ’é™¤ flink å†…éƒ¨å¯åŠ¨ä½œä¸šè€—æ—¶å› ç´ ï¼Œä½¿ç”¨ /jobs/overview æµ‹è¯•å¾®æœåŠ¡åˆ° flink çš„ç½‘ç»œè€—æ—¶ $time curl http://flink-jobmanager.default.svc.cluster.local:8091/jobs/overview {\"jobs\":[{\"jid\":\"0bf232afb7febbb8b070221833ddb99c\",\"name\":\"TopSpeedWindowing\",\"state\":\"RUNNING\",\"start-time\":1631687894914,\"end-time\":-1,\"duration\":701488855,\"last-modification\":1631687895895,\"tasks\":{\"total\":3,\"created\":0,\"scheduled\":0,\"deploying\":0,\"running\":3,\"finished\":0,\"canceling\":0,\"canceled\":0,\"failed\":0,\"reconciling\":0}}]} real 0m10.528s user 0m0.004s sys 0m0.005s æ ¹å› å®šä½ ======= å®šä½æ€è·¯ï¼šç†è§£ Service ã€K8s ç²¾é€‰ã€‘Kubernetes Service ä»‹ç»ã€‚åœ¨ä½¿ç”¨ service name å³åŸŸåçš„åœºæ™¯ä¸‹ï¼ŒClient Pod3 é¦–å…ˆæ‹¿ç€åŸŸåå» coredns è§£ææˆ ClusterIPï¼Œæ¥ç€å»è¯·æ±‚ ClusterIPï¼Œæœ€åé€šè¿‡ Kube-Proxy æŠŠè¯·æ±‚è½¬å‘åˆ°ç›®æ ‡åç«¯ Podã€‚ Kubernetes æœåŠ¡å‘ç°æ¶æ„. JPG ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:0:0","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"2.1 è™šæ‹ŸåŒ–ç½‘ç»œåˆ†æ 2.1.1 curl å‘½ä»¤è¯¦è§£ å‚è€ƒ curl å‘½ä»¤è¯¦è§£ï¼Œä¾‹å¦‚ curl --header \"Content-Type: application/json\" -X POST --data '{\"text\":\"germany\"}' https://labs.tib.eu/falcon/api?mode=short 2.1.2 curl è·å– http å„é˜¶æ®µçš„å“åº”æ—¶é—´ å‚è€ƒé€šè¿‡ curl å¾—åˆ° http å„é˜¶æ®µçš„å“åº”æ—¶é—´ â‘  time_namelookupï¼šDNS è§£ææ—¶é—´ â‘¡ time_connectï¼šè¿æ¥æ—¶é—´ï¼Œä»è¯·æ±‚å¼€å§‹åˆ° DNS è§£æå®Œæ¯•æ‰€ç”¨æ—¶é—´ã€‚å•çº¯çš„è¿æ¥æ—¶é—´ = time_connect - time_namelookup â‘¢ time_appconnectï¼šå»ºç«‹å®Œæˆæ—¶é—´ï¼Œä¾‹å¦‚ SSL/SSH ç­‰å»ºç«‹è¿æ¥æˆ–è€…å®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„æ—¶é—´ã€‚ â‘£ time_redirectï¼šé‡å®šå‘æ—¶é—´ï¼ŒåŒ…æ‹¬æœ€åä¸€æ¬¡ä¼ è¾“å‰çš„å‡ æ¬¡é‡å®šå‘çš„ DNS è§£æã€è¿æ¥ã€é¢„ä¼ è¾“ã€ä¼ è¾“æ—¶é—´ã€‚ â‘¤ time_pretransferï¼š ä»å¼€å§‹åˆ°å‡†å¤‡ä¼ è¾“çš„æ—¶é—´ã€‚ â‘¥ time_starttransferï¼šå¼€å§‹ä¼ è¾“æ—¶é—´ã€‚åœ¨ client å‘å‡ºè¯·æ±‚åï¼ŒæœåŠ¡ç«¯è¿”å›æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€ç”¨çš„æ—¶é—´ã€‚ è¿›å…¥ä¸šåŠ¡å®¹å™¨ï¼Œç¼–è¾‘å®Œè·å–æ•°æ®çš„æ ¼å¼åï¼Œæ‰§è¡Œ curl å‘½ä»¤ã€‚ /dev/null è¡¨ç¤ºç©ºè®¾å¤‡ï¼Œå³ä¸¢å¼ƒä¸€åˆ‡å†™å…¥çš„æ•°æ®ï¼Œä½†æ˜¾ç¤ºå†™å…¥æ“ä½œæˆåŠŸã€‚ $vim curl-format.txt time_namelookup: %{time_namelookup}\\n time_connect: %{time_connect}\\n time_appconnect: %{time_appconnect}\\n time_redirect: %{time_redirect}\\n time_pretransfer: %{time_pretransfer}\\n time_starttransfer: %{time_starttransfer}\\n ----------\\n time_total: %{time_total}\\n $kubectl get svc |grep flink flink-jobmanager ClusterIP 10.96.0.123 \u003cnone\u003e 8123/TCP,8124/TCP,8091/TCP 4d22h # é¦–å…ˆä½¿ç”¨ ClusterIP æµ‹è¯•æ¥å£è°ƒç”¨æ—¶é•¿ $curl -w \"@curl-format.txt\" -o /dev/null -l \"http://10.96.0.123:8091/jobs/overview\" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 660 100 660 0 0 81865 0 --:--:-- --:--:-- --:--:-- 94285 time_namelookup: 0.004 time_connect: 0.005 time_appconnect: 0.000 time_redirect: 0.000 time_pretransfer: 0.005 time_starttransfer: 0.008 ---------- time_total: 0.008 # ç„¶åä½¿ç”¨ service name å³åŸŸåæµ‹è¯•æ¥å£è°ƒç”¨æ—¶é•¿ $curl -w \"@curl-format.txt\" -o /dev/null -l \"http://flink-jobmanager.default.svc.cluster.local:8091/jobs/overview\" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 660 100 660 0 0 62 0 0:00:10 0:00:10 --:--:-- 164 time_melookup: 10.516 time_connect: 10.517 time_appconnect: 0.000 time_redirect: 0.000 time_pretransfer: 10.517 time_starttransfer: 10.520 ---------- time_total: 10.520 å¯¹æ¯” ClusterIP å’Œ service name çš„æ¥å£è°ƒç”¨æ—¶é•¿ï¼Œç”± time_namelookup å¯çŸ¥ DNS è§£ææ—¶é—´é•¿ã€‚ ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:1:0","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"2.2 åŸŸåè§£æåˆ†æ ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:2:0","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"2.2.1 å¤–éƒ¨åˆ†æ - coredns è§£æåŸŸå $kubectl logs coredns-66509f5cf2-km1q4 -nkube-system 2021-09-23T01:54:04.590Z [ERROR] plugin/errors: 2 flink-jobmanager.default.svc.cluster.local.openstacklocal. A: read udp 10.244.0.18:32960-\u003e100.79.1.250:53: i/o timeout 2021-09-23T01:54:09.592Z [ERROR] plugin/errors: 2 flink-jobmanager.default.svc.cluster.local.openstacklocal. A: read udp 10.244.0.18:59978-\u003e100.79.1.250:53: i/o timeout 2021-09-23T01:56:00.609Z [ERROR] plugin/errors: 2 flink-jobmanager.default.svc.cluster.local.openstacklocal. AAAA: read udp 10.244.2.19:41797-\u003e100.79.1.250:53: i/o timeout 2021-09-23T01:56:02.610Z [ERROR] plugin/errors: 2 flink-jobmanager.default.svc.cluster.local.openstacklocal. AAAA: read udp 10.244.2.19:48375-\u003e100.79.1.250:53: i/o timeout ç”± coredns åå°å…³é”®æ—¥å¿— A: read udp xxx-\u003exxx: i/o timeout å¯çŸ¥ IPV4 è§£æè¶…æ—¶ï¼ŒAAAA: read udp xxx-\u003exxx: i/o timeout å¯çŸ¥ IPV6 è§£æä¹Ÿè¶…æ—¶ã€‚ IPV4 å’Œ IPV6 è€—æ—¶å¯¹æ¯” # IPV4 è¯·æ±‚è€—æ—¶ $curl -4 -w \"@curl-format.txt\" -o /dev/null -l \"http://flink-jobmanager.default.svc.cluster.local:8091/jobs/overview\" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- 0:00:03 --:--:-- 0 time_melookup: 0.000 time_connect: 0.000 time_appconnect: 0.000 time_redirect: 0.000 time_pretransfer: 0.000 time_starttransfer: 0.000 ---------- time_total: 3.510 # IPV6 è¯·æ±‚è€—æ—¶ $curl -6 -w \"@curl-format.txt\" -o /dev/null -l \"http://flink-jobmanager.default.svc.cluster.local:8091/jobs/overview\" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 660 100 660 0 0 146 0 0:00:04 0:00:04 --:--:-- 146 time_melookup: 4.511 time_connect: 4.512 time_appconnect: 0.000 time_redirect: 0.000 time_pretransfer: 4.512 time_starttransfer: 4.515 ---------- time_total: 4.515 ç»“è®ºï¼šIPV6 è§£ææ¯” IPV4 å¤šè€—æ—¶çº¦ 20%ï¼Œè¯´æ˜ IPV6 å¯¹åŸŸåè§£ææœ‰ä¸€å®šçš„å½±å“ï¼Œå»ºè®® coredns å…³é—­ IPV6 è§£æã€‚ç„¶è€Œç›´æ¥ç”¨ IPV4 è§£æä¹Ÿè€—æ—¶ 3s+ï¼Œéœ€è¦è¿›ä¸€æ­¥å¯¹å®¹å™¨å†…éƒ¨è¿›è¡ŒæŠ“åŒ…åˆ†æã€‚ å»ºè®®ï¼šå¦‚æœ IPV6 æ¨¡å¼æ²¡æœ‰ä½¿ç”¨ï¼Œå¯ä»¥å…³é—­ã€‚ ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:2:1","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"2.2.2 å†…éƒ¨åˆ†æ - å®¹å™¨å†…éƒ¨è§£æåŸŸå é€šè¿‡å®¿ä¸»æœºæŠ“èµ· Pod ç½‘ç»œæ•°æ®æŠ¥ nsenter å¯ä»¥è¿›å…¥ Pod å®¹å™¨ net å‘½åç©ºé—´ï¼ŒåŒæ—¶æä¾›ä¸€ä¸ªå¿«é€Ÿè¿›å…¥ Pod å®¹å™¨ net å‘½åç©ºé—´è„šæœ¬ï¼Œå¯ä»¥å‚è€ƒåœ¨å®¹å™¨ç¯å¢ƒä½¿ç”¨ tcpdump æŠ“åŒ… # æ­¥éª¤1 è·å–å®¹å™¨çš„ pid $ docker ps |grep flink-jobmanager-7b58565dc8-msgpp 1386ce6244ae 192.168.31.37:5000/flink \"bash -cx /opt/flink/sâ€¦\" 3 weeks ago Up 3 weeks k8s_flink-jobmanager-7b58565dc8-msgpp_4b6d15d8-7b54-41fb-bf46-ffa91aa33963_0 $ docker inspect 1386ce6244ae| grep Pid \"Pid\": 63046, \"PidMode\": \"\", \"PidsLimit\": 0, # æ­¥éª¤2 æ ¹æ® pid æ‰§è¡Œå‘½ä»¤ # 53 æ˜¯ corends åŸŸåè§£æç«¯å£ $ nsenter -t 63046 -n $ tcpdump 'src host 10.244.3.81 and src port 8091' # æ­¥éª¤3 æ‰“å¼€æ–°çª—å£ï¼Œè¿›å…¥å®¹å™¨å¹¶æ‰§è¡Œä¸Šè¿°çš„ curl å‘½ä»¤ $curl -w \"@curl-format.txt\" -o /dev/null -l \"http://flink-jobmanager.default.svc.cluster.local:8091/jobs/overview\" ä¸‹è½½ tcpdump çš„æŠ“åŒ…æ•°æ® xxx.pcapï¼Œ åˆ©ç”¨ wireshark åˆ†æ tcpdump æŠ¥æ–‡ï¼Œå…¶ç»“æœå¦‚ä¸‹ï¼š â‘  flink-jobmanager.default.svc.cluster.local åŸŸåè§£ææˆ ip çš„æ—¶é—´çº¦ 10s â‘¡ åœ¨åŸŸåè§£æçš„è¿‡ç¨‹ä¸­ï¼Œåœ¨ flink-jobmanager.default.svc.cluster.local çš„åŸºç¡€ä¸Šï¼Œå…¶åç¼€ä¾æ¬¡æ·»åŠ  default.svc.cluster.localã€svc.cluster.localã€cluster.localã€openstacklocal æŸ¥çœ‹ä¸šåŠ¡å®¹å™¨ä¸­çš„é…ç½® /etc/resolv.confï¼Œå‘ç°ä¸Šè¿°çš„åç¼€æ°å¥½æ˜¯ search å†…å®¹ã€‚ $ cat /etc/resolv.conf nameserver 10.96.0.10 search default.svc.cluster.local svc.cluster.local cluster.local openstacklocal options ndots:5 single-request-reopen 3 å®¹å™¨ /etc/resolv.conf é…ç½®åˆ†æ å®¹å™¨ /etc/resolv.conf é…ç½®å¦‚ä¸‹ï¼š nameserver 10.96.0.10 search default.svc.cluster.local svc.cluster.local cluster.local openstacklocal options ndots:5 single-request-reopen ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:2:2","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"â‘  nameserver resolv.conf æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ nameserverï¼Œå†…å®¹æ˜¯ coredns çš„ ClusterIP $kubectl get svc -nkube-system |grep dns kube-dns ClusterIP 10.96.0.10 \u003cnone\u003e 53/UDP,53/TCP 167d ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:2:3","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"â‘¡ search resolv.conf æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ searchã€‚å½“åŸŸåè§£æçš„æ—¶å€™ï¼Œå°†åŸŸåä¾æ¬¡æ·»åŠ åç¼€ï¼Œä¾‹å¦‚ï¼š flink-jobmanager.default.svc.cluster.local.default.svc.cluster.local flink-jobmanager.default.svc.cluster.local.svc.cluster.local flink-jobmanager.default.svc.cluster.local.cluster.local flink-jobmanager.default.svc.cluster.local.openstacklocal ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:2:4","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"â‘¢ options resolv.conf æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ options å…¶å®ƒé¡¹ï¼Œå¸¸è§é…ç½®æ˜¯ ndotsã€‚ndots: 5 è¡¨ç¤ºå¦‚æœåŸŸååŒ…å«çš„ â€œ.â€ å°‘äº 5 ä¸ªï¼Œåˆ™å…ˆæ·»åŠ  search åç¼€ï¼Œå†ä½¿ç”¨ç»å¯¹åŸŸåï¼›å¦‚æœåŸŸååŒ…å«çš„ â€œ.â€ å¤§äºç­‰äº 5 ä¸ªï¼Œåˆ™å…ˆä½¿ç”¨ç»å¯¹åŸŸåï¼Œå†æ·»åŠ  search åç¼€ã€‚ #æ ·ä¾‹1 åŸŸåa.b.c.d.eï¼Œåˆ™åŸŸåçš„é¡ºåºå¦‚ä¸‹ a.b.c.d.e.default.svc.cluster.local a.b.c.d.e.svc.cluster.local a.b.c.d.e.cluster.local a.b.c.d.e.openstacklocal a.b.c.d.e #æ ·ä¾‹2 åŸŸåa.b.c.d.e.fï¼Œåˆ™åŸŸåçš„é¡ºåºå¦‚ä¸‹ a.b.c.d.e.f a.b.c.d.e.f.default.svc.cluster.local a.b.c.d.e.f.svc.cluster.local a.b.c.d.e.f.cluster.local a.b.c.d.e.f.openstacklocal ç»“åˆ flink-jobmanager.default.svc.cluster.local åŸŸåè§£ææ…¢çš„é—®é¢˜ï¼Œç”±äºè¯¥åŸŸååŒ…å« â€œ.â€ ç­‰äº 4ï¼Œå³å°‘äº 5ï¼Œæ‰€ä»¥ä¼šé¦–å…ˆä¾æ¬¡æ·»åŠ åç¼€ default.svc.cluster.localã€svc.cluster.localã€cluster.local openstacklocalã€‚å› æ­¤ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ â‘ flink-jobmanager.default.svc.cluster.local ä¿®æ”¹ä¸º flink-jobmanagerï¼›â‘¡ndots: 5 ä¿®æ”¹ä¸º ndots: 4ã€‚ 4 è§£å†³æ–¹æ¡ˆ ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:2:5","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"4.1 ä½¿ç”¨ç®€æ´åŸŸå å°†è®¿é—®çš„åŸŸåä» flink-jobmanager.default.svc.cluster.local ä¿®æ”¹ä¸º flink-jobmanagerï¼Œæ•ˆæœå¦‚ä¸‹ï¼š curl -w \"@curl-format.txt\" -o /dev/null -l \"http://flink-jobmanager:8091/jobs/overview\" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 660 100 660 0 0 82038 0 --:--:-- --:--:-- --:--:-- 94285 time_melookup: 0.004 time_connect: 0.005 time_appconnect: 0.000 time_redirect: 0.000 time_pretransfer: 0.005 time_starttransfer: 0.008 ---------- time_total: 0.008 ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:2:6","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"4.2 resolv.conf é…ç½®æ›´æ”¹ å°† /etc/resolv.conf çš„ options é…ç½® ndots: 5 ä¿®æ”¹ä¸º ndots: 4ï¼Œæˆ–è€…ä¿®æ”¹ deployment çš„ yaml é…ç½®ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š # ä¿®æ”¹ deployment çš„ yaml é…ç½® # spec.spec.dnsConfig.options[].ndots dnsConfig: options: - name: ndots value: 4 - name: single-request-reopen curl -w \"@curl-format.txt\" -o /dev/null -l \"http://flink-jobmanager.default.svc.cluster.local:8091/jobs/overview\" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 660 100 660 0 0 82038 0 --:--:-- --:--:-- --:--:-- 94285 time_melookup: 0.005 time_connect: 0.006 time_appconnect: 0.000 time_redirect: 0.000 time_pretransfer: 0.005 time_starttransfer: 0.008 ---------- time_total: 0.008 ","date":"2023-12-27","objectID":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/:2:7","tags":[""],"title":"corednsè§£æè¶…æ—¶é—®é¢˜","uri":"/%E8%A7%A3%E6%9E%90%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"},{"categories":["documentation"],"content":"Nginx 502é—®é¢˜æ’æŸ¥ ","date":"2023-12-19","objectID":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/:0:0","tags":["nginx"],"title":"Nginx 502é—®é¢˜æ’æŸ¥","uri":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"},{"categories":["documentation"],"content":"nginxå¿«é€Ÿå®šä½å¼‚å¸¸ é”™è¯¯ä¿¡æ¯ é”™è¯¯è¯´æ˜ â€œupstream prematurelyï¼ˆè¿‡æ—©çš„ï¼‰ closed connectionâ€ è¯·æ±‚uriçš„æ—¶å€™å‡ºç°çš„å¼‚å¸¸ï¼Œæ˜¯ç”±äºupstreamè¿˜æœªè¿”å›åº”ç­”ç»™ç”¨æˆ·æ—¶ç”¨æˆ·æ–­æ‰è¿æ¥é€ æˆçš„ï¼Œå¯¹ç³»ç»Ÿæ²¡æœ‰å½±å“ï¼Œå¯ä»¥å¿½ç•¥ â€œrecv() failed (104: Connection reset by peer)â€ ï¼ˆ1ï¼‰æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°è¶…è¿‡äº†å…¶æ‰¿è½½é‡ï¼ŒæœåŠ¡å™¨ä¼šå°†å…¶ä¸­ä¸€äº›è¿æ¥Downæ‰ï¼› ï¼ˆ2ï¼‰å®¢æˆ·å…³æ‰äº†æµè§ˆå™¨ï¼Œè€ŒæœåŠ¡å™¨è¿˜åœ¨ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼› ï¼ˆ3ï¼‰æµè§ˆå™¨ç«¯æŒ‰äº†Stop â€œ(111: Connection refused) while connecting to upstreamâ€ ç”¨æˆ·åœ¨è¿æ¥æ—¶ï¼Œè‹¥é‡åˆ°åç«¯upstreamæŒ‚æ‰æˆ–è€…ä¸é€šï¼Œä¼šæ”¶åˆ°è¯¥é”™è¯¯ â€œ(111: Connection refused) while reading response header from upstreamâ€ ç”¨æˆ·åœ¨è¿æ¥æˆåŠŸåè¯»å–æ•°æ®æ—¶ï¼Œè‹¥é‡åˆ°åç«¯upstrreamæŒ‚æ‰æˆ–è€…ä¸é€šï¼Œä¼šæ”¶åˆ°è¯¥é”™è¯¯ â€œ(111: Connection refused) while sending request to upstreamâ€ Nginxå’Œupstreamè¿æ¥æˆåŠŸåå‘é€æ•°æ®æ—¶ï¼Œè‹¥é‡åˆ°åç«¯upstreamæŒ‚æ‰æˆ–è€…ä¸é€šï¼Œä¼šæ”¶åˆ°è¯¥é”™è¯¯ â€œ(110: Connection timed out) while connecting to upstreamâ€ nginxè¿æ¥åé¢çš„upstreamæ—¶è¶…æ—¶ â€œ(110: Connection timed out) while reading upstreamâ€ nginxè¯»å–æ¥è‡ªupstreamçš„å“åº”æ—¶è¶…æ—¶ â€œ(110: Connection timed out) while reading response header from upstreamâ€ nginxè¯»å–æ¥è‡ªupstreamçš„å“åº”å¤´æ—¶è¶…æ—¶ â€œ(110: Connection timed out) while reading upstreamâ€ nginxè¯»å–æ¥è‡ªupstreamçš„å“åº”æ—¶è¶…æ—¶ â€œ(104: Connection reset by peer) while connecting to upstreamâ€ upstreamå‘é€äº†RSTï¼Œå°†è¿æ¥é‡ç½® â€œupstream sent invalid header while reading response header from upstreamâ€ upstreamå‘é€çš„å“åº”å¤´æ— æ•ˆ â€œupstream sent no valid HTTP/1.0 header while reading response header from upstreamâ€ upstreamå‘é€çš„å“åº”å¤´æ— æ•ˆ â€œclient intended to send too large bodyâ€ ç”¨äºè®¾ç½®å…è®¸æ¥å—çš„å®¢æˆ·ç«¯è¯·æ±‚å†…å®¹çš„æœ€å¤§å€¼ï¼Œé»˜è®¤å€¼æ˜¯1Mï¼Œclientå‘é€çš„bodyè¶…è¿‡äº†è®¾ç½®å€¼ ","date":"2023-12-19","objectID":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/:1:0","tags":["nginx"],"title":"Nginx 502é—®é¢˜æ’æŸ¥","uri":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"},{"categories":["documentation"],"content":"Nginxæ—¥å¿—çŠ¶æ€ç ä¸º502 ","date":"2023-12-19","objectID":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/:2:0","tags":["nginx"],"title":"Nginx 502é—®é¢˜æ’æŸ¥","uri":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"},{"categories":["documentation"],"content":"è´Ÿè½½å‡è¡¡å®ä¾‹è¿æ¥æ•°è¶…é™(Connection reset by peer) æŠ¥é”™: recv() failed (104: Connection reset by peer) while reading response header from upstream çº¿ä¸ŠNginxè¿è¡Œäº†nå¹´åï¼Œä¸šåŠ¡å‘ç°æœ‰502é”™è¯¯çš„é”™è¯¯ï¼Œé€šè¿‡æ’æŸ¥å‘ç°è¿™ä¸ª502å·²ç»æŒç»­äº†å¾ˆä¹…å¾ˆä¹…ï¼Œé€šè¿‡erroræ—¥å¿—å‘ç°æŠ¥é”™æ˜¯recv() failed (104: Connection reset by peer) while reading response header from upstream ä¸šåŠ¡æ¶æ„ è´Ÿè½½å‡è¡¡: å‡ä½¿ç”¨é˜¿é‡Œäº‘çš„CLBå®ä¾‹ æ—¥å¿—æ’æŸ¥ æ’æŸ¥æ—¥å¿—å‘ç°, å‘ç°Istio Gatewayæ²¡æœ‰æ”¶åˆ°Nginxçš„è¯·æ±‚, æ‰€ä»¥åˆ¤æ–­é—®é¢˜å‡ºåœ¨ Nginxåˆ°Istio Gateway æŠ“åŒ… é€šè¿‡æŠ“åŒ…å‘ç°ï¼ŒTCPè¿æ¥å»ºç«‹ä¹‹åï¼ŒNginxå‘é€çš„HTTPè¯·æ±‚å¹¶æ²¡æœ‰å‘é€åˆ°Istio 502é—®é¢˜æ’æŸ¥-wireshark-rest è§£å†³ é€šè¿‡æŸ¥çœ‹é˜¿é‡Œäº‘çš„SLBç›‘æ§ï¼Œå‘ç°å†…ç½‘Istioè´Ÿè½½å‡è¡¡æœ‰ä¸¢åŒ…çš„æƒ…å†µï¼Œäºæ˜¯å¯¹CLBå®ä¾‹è¿›è¡Œäº†å‡é…ï¼Œä¿®å¤äº†è¿™ä¸ªé—®é¢˜ ","date":"2023-12-19","objectID":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/:2:1","tags":["nginx"],"title":"Nginx 502é—®é¢˜æ’æŸ¥","uri":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"},{"categories":["documentation"],"content":"Connection timed out upstream timed out (110: Connection timed out) while connecting to upstream connect() failed (110: Connection timed out) while connecting to upstream å¯¹CLBå®ä¾‹å‡é…åï¼Œè™½ç„¶502å°‘äº†ç‰¹åˆ«å¤šï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰502çš„è¯·æ±‚ï¼ŒæŠ¥é”™æ˜¯upstream timed out (110: Connection timed out) while connecting to upstream ","date":"2023-12-19","objectID":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/:2:2","tags":["nginx"],"title":"Nginx 502é—®é¢˜æ’æŸ¥","uri":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"},{"categories":["documentation"],"content":"è§£å†³æ–¹æ¡ˆ å¢åŠ keepalive, å…·ä½“å¯ä»¥å‚è€ƒæ–‡æ¡£: https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive ç¤ºä¾‹ upstream http_backend { server 127.0.0.1:8080; keepalive 16; } server { ... location /http/ { proxy_pass http://http_backend; proxy_http_version 1.1; proxy_set_header Connection \"\"; ... } } åç»­ ","date":"2023-12-19","objectID":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/:2:3","tags":["nginx"],"title":"Nginx 502é—®é¢˜æ’æŸ¥","uri":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"},{"categories":["documentation"],"content":"ä¸ºä½•SLBå¹¶å‘æ”¯æŒçš„è¿™ä¹ˆå° https://www.alibabacloud.com/help/zh/slb/classic-load-balancer/user-guide/faq-about-clb#section-3kw-gvt-8go åœºæ™¯æè¿°ï¼šåœ¨ä½¿ç”¨å°‘é‡é•¿è¿æ¥çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œè½¬å‘åˆ†ç»„ä¸­çš„ç³»ç»ŸæœåŠ¡å™¨å¯èƒ½ä¸ä¼šå…¨éƒ¨è¢«åˆ†é…åˆ°é•¿è¿æ¥ï¼Œå¯èƒ½ä¼šå‡ºç°CLBå®ä¾‹è¾¾ä¸åˆ°QPSå³°å€¼çš„ç°è±¡ã€‚ åŸç†ï¼ˆåŸå› ï¼‰ï¼š å› ä¸ºè´Ÿè½½å‡è¡¡ç³»ç»Ÿé€šè¿‡é›†ç¾¤éƒ¨ç½²çš„æ–¹å¼ä¸ºè´Ÿè½½å‡è¡¡å®ä¾‹æä¾›æœåŠ¡ï¼Œæ‰€æœ‰å¤–éƒ¨çš„è®¿é—®è¯·æ±‚éƒ½å°†å¹³å‡åˆ†æ•£åˆ°è¿™äº›è´Ÿè½½å‡è¡¡ç³»ç»ŸæœåŠ¡å™¨ä¸Šè¿›è¡Œè½¬å‘ã€‚æ‰€ä»¥ï¼ŒCLBå®ä¾‹çš„QPSå³°å€¼å°†è¢«å¹³å‡è®¾å®šåœ¨å¤šå°ç³»ç»ŸæœåŠ¡å™¨ä¸Šã€‚ å•ä¸ªç³»ç»ŸæœåŠ¡å™¨çš„QPSä¸Šé™è®¡ç®—æ–¹æ³•ä¸ºï¼šå•ä¸ªç³»ç»ŸæœåŠ¡å™¨QPSå³°å€¼=å®ä¾‹æ€»QPS/ï¼ˆN-1ï¼‰ã€‚Nä¸ºè½¬å‘åˆ†ç»„ä¸­ç³»ç»ŸæœåŠ¡å™¨çš„ä¸ªæ•°ã€‚ä¾‹å¦‚æ‚¨åœ¨æ§åˆ¶å°ä¸Šè´­ä¹°äº†ç®€çº¦å‹Iï¼ˆslb.s1.smallï¼‰è§„æ ¼çš„CLBå®ä¾‹ï¼Œå¯¹åº”çš„QPSä¸º1000ï¼Œå½“å¤šå®¢æˆ·ç«¯åŒæ—¶ä½¿ç”¨æ—¶ï¼Œæ€»QPSå¯ä»¥è¾¾åˆ°1000 QPSã€‚è‹¥ç³»ç»ŸæœåŠ¡å™¨ä¸ªæ•°ä¸º8ï¼Œé‚£ä¹ˆå•ä¸ªç³»ç»ŸæœåŠ¡å™¨çš„æœ€å¤§QPSä¸º1000/(8-1)=142 QPSã€‚ æ¨èæ–¹æ¡ˆï¼š ä½¿ç”¨å•å®¢æˆ·ç«¯çŸ­è¿æ¥è¿›è¡Œå‹æµ‹ã€‚ æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µå‡å°‘è¿æ¥å¤ç”¨ã€‚ å‡é…CLBå®ä¾‹è§„æ ¼ã€‚å…·ä½“æ“ä½œï¼Œè¯·å‚è§æŒ‰é‡ä»˜è´¹ï¼ˆæŒ‰è§„æ ¼è®¡è´¹ï¼‰å‡é™é…ã€‚ ä½¿ç”¨ALBå®ä¾‹ï¼Œæ­¤ç§æ–¹æ¡ˆä¸‹è´Ÿè½½å‡è¡¡å®ä¾‹å…·æœ‰è¶³å¤Ÿçš„å¼¹æ€§ã€‚ ","date":"2023-12-19","objectID":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/:3:0","tags":["nginx"],"title":"Nginx 502é—®é¢˜æ’æŸ¥","uri":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"},{"categories":["documentation"],"content":"å‚è€ƒæ–‡æ¡£ Nginx: Connection reset by peer é”™è¯¯å®šä½ nginx(äºŒåä¹)error.logè®°å½•æŠ¥é”™ä¿¡æ¯åˆ†æ ","date":"2023-12-19","objectID":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/:4:0","tags":["nginx"],"title":"Nginx 502é—®é¢˜æ’æŸ¥","uri":"/502%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"},{"categories":["documentation","windows"],"content":"powershellè®¾ç½®è‡ªåŠ¨è¡¥å…¨ notepad.exe $PROFILE hugo.exe completion powershell | Out-String | Invoke-Expression ","date":"2023-11-30","objectID":"/powershell-completion/:0:0","tags":["windows"],"title":"Powershell Completion","uri":"/powershell-completion/"},{"categories":["documentation","hugo"],"content":"hugo page first page ","date":"2023-11-28","objectID":"/first/:0:0","tags":["hugo"],"title":"First","uri":"/first/"},{"categories":null,"content":"å…³äº LoveIt","date":"2019-08-02","objectID":"/about/","tags":null,"title":"å…³äº LoveIt","uri":"/about/"},{"categories":null,"content":" å®ƒçš„åŸå‹åŸºäº LeaveIt ä¸»é¢˜ å’Œ KeepIt ä¸»é¢˜ã€‚ æ‰«ç å…³æ³¨å¾®ä¿¡å…¬ä¼—å· ","date":"2019-08-02","objectID":"/about/:0:0","tags":null,"title":"å…³äº LoveIt","uri":"/about/"}]